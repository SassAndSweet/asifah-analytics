name: Daily Cache Update

on:
  schedule:
    # Runs every day at 12:00 UTC (7am EST / 4am PST)
    - cron: '0 12 * * *'
  
  # Allow manual triggering from Actions tab
  workflow_dispatch:

jobs:
  update-caches:
    runs-on: ubuntu-latest
    
    steps:
      - name: Update Lebanon Stability Cache
        run: |
          echo "Pinging Lebanon endpoint..."
          curl -X GET "https://asifah-backend.onrender.com/scan-lebanon-stability" \
            --max-time 60 \
            --retry 2 \
            --retry-delay 5
          echo "âœ… Lebanon cache updated"
      
      - name: Update Iran Protests Cache
        run: |
          echo "Pinging Iran endpoint..."
          curl -X GET "https://asifah-backend.onrender.com/scan-iran-protests?days=7" \
            --max-time 60 \
            --retry 2 \
            --retry-delay 5
          echo "âœ… Iran cache updated"
      
      - name: Summary
        run: |
          echo "ðŸŽ‰ All caches updated successfully!"
          echo "Timestamp: $(date -u)"
