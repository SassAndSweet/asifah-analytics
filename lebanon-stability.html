<!DOCTYPE html>
<!-- Asifah Analytics - Lebanon Stability Index v2.9.0 - Last updated: Feb 24, 2026 -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Lebanon Stability Index | Asifah Analytics v2.9.0</title>
    
    <!-- Favicon using Asifah Analytics logo -->
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/SassAndSweet/asifah-analytics/main/Asifah_Analytics_1_25_26_V1_LOGO.png">
    
    <!-- Chart.js for sparklines -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Leaflet for Lebanon Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* ============================================
           CSS Variables for Light/Dark Mode
           v2.9.0: Cyber blue dark theme + watermark fix
           ============================================ */
        :root {
            /* Light Mode Colors */
            --bg-color: #f5f5f5;
            --container-bg: #ffffff;
            --card-bg: #ffffff;
            --card-border: #e1e8ed;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --text-muted: #95a5a6;
            --header-gradient-start: #1e3a5f;
            --header-gradient-end: #2c5282;
            --header-text: #ffffff;
            --stability-bg: rgba(255, 255, 255, 0.95);
            --metric-bg: #ffffff;
            --metric-hover-shadow: rgba(0,0,0,0.15);
            --article-bg: #f8f9fa;
            --article-hover: #e8f4f8;
            --loading-overlay-bg: rgba(245, 245, 245, 0.98);
            --loading-spinner-bg: rgba(100, 149, 237, 0.2);
            /* Watermark: visible but subtle on light */
            --watermark-opacity: 0.50;
            /* Card glow (none on light) */
            --card-glow: none;
            --card-hover-glow: 0 8px 20px rgba(0,0,0,0.15);
        }

        [data-theme="dark"] {
            /* v2.9.0: Cyber Blue Dark Mode */
            --bg-color: #0a0e1a;
            --container-bg: #111827;
            --card-bg: #111827;
            --card-border: #1e3a5f;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --header-gradient-start: #0f1a2e;
            --header-gradient-end: #1e3a5f;
            --header-text: #ffffff;
            --stability-bg: rgba(17, 24, 39, 0.95);
            --metric-bg: #111827;
            --metric-hover-shadow: rgba(100, 149, 237, 0.15);
            --article-bg: #1a2332;
            --article-hover: #243447;
            --loading-overlay-bg: rgba(10, 14, 26, 0.98);
            --loading-spinner-bg: rgba(100, 149, 237, 0.4);
            /* Watermark: prominent cyber blue glow in dark mode */
            --watermark-opacity: 0.85;
            /* Card glow effects */
            --card-glow: 0 0 1px rgba(100, 149, 237, 0.1);
            --card-hover-glow: 0 0 20px rgba(100, 149, 237, 0.2), 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            font-size: 14px;
            background-color: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            transition: background-color 0.3s ease, color 0.3s ease;
            position: relative;
        }

        /* ============================================
           Watermark Background - v2.9.0 FIXED
           Light: 50% opacity, subtle
           Dark: Near-full with blue tint via filter
           ============================================ */
        body::before {
            content: '';
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90vmin;
            height: 90vmin;
            min-width: 600px;
            min-height: 600px;
            max-width: 1000px;
            max-height: 1000px;
            background-image: url('https://raw.githubusercontent.com/SassAndSweet/asifah-analytics/main/Asifah_Analytics_1_25_26_V1_LOGO.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: var(--watermark-opacity);
            z-index: 0;
            pointer-events: none;
            user-select: none;
        }

        /* Dark mode: tint the watermark with cyber blue */
        [data-theme="dark"] body::before {
            filter: brightness(0.3) sepia(1) hue-rotate(180deg) saturate(3);
        }

        /* Loading Overlay Styles */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--loading-overlay-bg);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }

        .loading-overlay.hidden {
            opacity: 0;
            visibility: hidden;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid var(--loading-spinner-bg);
            border-top-color: #6495ED;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 30px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-status {
            text-align: center;
            max-width: 500px;
            padding: 0 20px;
        }

        .loading-title {
            font-size: 24px;
            font-weight: bold;
            color: #6495ED;
            margin-bottom: 20px;
            letter-spacing: 1px;
        }

        .loading-steps {
            margin-top: 20px;
        }

        .loading-step {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            padding: 12px;
            font-size: 15px;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .loading-step.active {
            color: #6495ED;
            font-weight: bold;
        }

        .loading-step.complete {
            color: #4ade80;
        }

        .step-icon {
            font-size: 18px;
            min-width: 20px;
        }

        .loading-progress {
            margin-top: 25px;
            font-size: 13px;
            color: var(--text-secondary);
            font-style: italic;
        }

        .loading-error {
            color: #f87171;
            font-size: 16px;
            margin-top: 20px;
            padding: 15px;
            background: rgba(248, 113, 113, 0.1);
            border: 1px solid rgba(248, 113, 113, 0.3);
            border-radius: 8px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            background: linear-gradient(135deg, var(--header-gradient-start) 0%, var(--header-gradient-end) 100%);
            color: var(--header-text);
            padding: 35px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            position: relative;
            display: flex;
            align-items: center;
            gap: 30px;
        }

        /* Dark mode: add subtle blue border to header */
        [data-theme="dark"] header {
            border: 1px solid rgba(100, 149, 237, 0.2);
            box-shadow: 0 6px 30px rgba(0, 0, 0, 0.4), 0 0 15px rgba(100, 149, 237, 0.05);
        }

        .header-logo {
            width: 80px;
            height: 80px;
            flex-shrink: 0;
            border-radius: 50%;
            margin-top: 48px;
        }

        .header-content {
            flex: 1;
            text-align: center;
        }

        h1 {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
            letter-spacing: 2px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 16px;
            font-weight: normal;
            opacity: 0.95;
            letter-spacing: 0.5px;
        }

        .last-updated {
            font-size: 13px;
            opacity: 0.85;
            margin-top: 10px;
        }

        /* Controls container on the right */
        .header-controls {
            position: absolute;
            top: 35px;
            right: 35px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        [dir="rtl"] .header-controls {
            right: auto;
            left: 35px;
        }

        /* Language Switcher */
        .language-switcher {
            display: flex;
            gap: 8px;
            background: rgba(255,255,255,0.15);
            padding: 8px 12px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: rgba(255,255,255,0.15);
            padding: 8px 12px;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .theme-toggle-label {
            font-size: 11px;
            color: rgba(255,255,255,0.9);
            margin-right: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .theme-toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            background: rgba(255,255,255,0.2);
            border-radius: 13px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .theme-toggle-switch:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }

        .theme-toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .theme-toggle-slider::before {
            content: '‚òÄÔ∏è';
        }

        [data-theme="dark"] .theme-toggle-slider {
            transform: translateX(24px);
        }

        [data-theme="dark"] .theme-toggle-slider::before {
            content: 'üåô';
        }

        .lang-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            color: white;
            padding: 6px 14px;
            font-family: 'Times New Roman', Times, serif;
            font-size: 14px;
            font-weight: bold;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .lang-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }

        .lang-btn.active {
            background: white;
            color: #1e3a5f;
            border-color: white;
        }

        /* Stability Index Card */
        .stability-index-card {
            background: var(--stability-bg);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--card-glow);
            border: 2px solid var(--card-border);
            transition: background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .stability-title {
            font-size: 20px;
            margin-bottom: 20px;
            text-align: center;
            color: var(--text-primary);
            font-weight: bold;
            letter-spacing: 1px;
        }

        .stability-score {
            font-size: 72px;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }

        .stability-score.green { color: #4ade80; }
        .stability-score.yellow { color: #facc15; }
        .stability-score.orange { color: #fb923c; }
        .stability-score.red { color: #f87171; }

        /* Dark mode: add glow to score colors */
        [data-theme="dark"] .stability-score.green { text-shadow: 0 0 20px rgba(74, 222, 128, 0.3); }
        [data-theme="dark"] .stability-score.yellow { text-shadow: 0 0 20px rgba(250, 204, 21, 0.3); }
        [data-theme="dark"] .stability-score.orange { text-shadow: 0 0 20px rgba(251, 146, 60, 0.3); }
        [data-theme="dark"] .stability-score.red { text-shadow: 0 0 20px rgba(248, 113, 113, 0.3); }

        .stability-label {
            text-align: center;
            font-size: 20px;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .stability-label.green { color: #4ade80; }
        .stability-label.yellow { color: #facc15; }
        .stability-label.orange { color: #fb923c; }
        .stability-label.red { color: #f87171; }

        .stability-bar {
            width: 100%;
            height: 30px;
            background: var(--card-border);
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .stability-fill {
            height: 100%;
            background: linear-gradient(90deg, #f87171 0%, #fb923c 25%, #facc15 50%, #4ade80 100%);
            transition: width 0.5s ease;
            border-radius: 15px;
        }

        .stability-legend {
            text-align: center;
            font-size: 13px;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Sparkline styles */
        .sparkline-container {
            margin-top: 15px;
            padding: 10px;
            background: var(--article-bg);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background 0.3s ease;
        }

        .sparkline-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-right: 10px;
        }

        .sparkline-canvas {
            flex-grow: 1;
            max-width: 150px;
            height: 40px;
        }

        .sparkline-status {
            font-size: 12px;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: var(--metric-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--card-glow);
            border: 2px solid var(--card-border);
            transition: transform 0.2s, background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--card-hover-glow);
        }

        /* Dark mode: blue border glow on hover */
        [data-theme="dark"] .metric-card:hover {
            border-color: rgba(100, 149, 237, 0.4);
        }

        .metric-title {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        /* Dark mode: accent the metric titles */
        [data-theme="dark"] .metric-title {
            color: #6495ED;
        }

        .metric-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .metric-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
        }

        /* Government Status */
        .government-status {
            background: var(--article-bg);
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            transition: background 0.3s ease;
        }

        .government-status-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--card-border);
        }

        .government-status-item:last-child {
            border-bottom: none;
        }

        .status-label {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .status-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        .status-value.warning {
            color: #fb923c;
        }

        .status-value.critical {
            color: #f87171;
        }

        /* Hezbollah Activity */
        .activity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .activity-item {
            background: var(--article-bg);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            transition: background 0.3s ease;
        }

        .activity-number {
            font-size: 28px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .activity-label {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        /* Articles Section */
        .articles-section {
            background: var(--container-bg);
            border-radius: 12px;
            padding: 25px;
            margin-top: 30px;
            box-shadow: var(--card-glow);
            border: 2px solid var(--card-border);
            transition: background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .section-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--text-primary);
            font-weight: bold;
            letter-spacing: 0.5px;
        }

        .article-item {
            background: var(--article-bg);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: background 0.2s ease, transform 0.2s;
            border-left: 4px solid #1e3a5f;
        }

        /* Dark mode: brighter accent border on articles */
        [data-theme="dark"] .article-item {
            border-left-color: #6495ED;
        }

        [dir="rtl"] .article-item {
            border-left: none;
            border-right: 4px solid #1e3a5f;
        }

        [dir="rtl"][data-theme="dark"] .article-item {
            border-right-color: #6495ED;
        }

        .article-item:hover {
            background: var(--article-hover);
            transform: translateX(4px);
        }

        [dir="rtl"] .article-item:hover {
            transform: translateX(-4px);
        }

        .article-title {
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .article-meta {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .article-link {
            color: #6495ED;
            text-decoration: none;
            font-size: 13px;
        }

        .article-link:hover {
            text-decoration: underline;
        }

        /* Dark mode: brighter link color */
        [data-theme="dark"] .article-link {
            color: #7dabf8;
        }

        /* Footer */
        footer {
            background: var(--container-bg);
            padding: 25px;
            border-radius: 12px;
            box-shadow: var(--card-glow);
            border: 2px solid var(--card-border);
            font-size: 12px;
            text-align: center;
            margin-top: 40px;
            color: var(--text-secondary);
            transition: background 0.3s ease, border-color 0.3s ease;
        }

        .back-link {
            display: inline-block;
            position: absolute;
            top: 20px;
            left: 20px;
            margin: 0;
            padding: 12px 24px;
            background: rgba(255,255,255,0.2);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            border: 2px solid rgba(255,255,255,0.3);
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: bold;
        }

        .back-link:hover {
            background: rgba(255,255,255,0.3);
            border-color: rgba(255,255,255,0.5);
        }

        /* Knowledge Library Styles */
        .knowledge-library {
            background: var(--container-bg);
            border: 2px solid var(--card-border);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--card-glow);
            transition: background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .knowledge-library h2 {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .library-icon {
            font-size: 28px;
        }

        .knowledge-categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .knowledge-card {
            background: var(--card-bg);
            border: 2px solid var(--card-border);
            border-radius: 10px;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .knowledge-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--card-hover-glow);
        }

        [data-theme="dark"] .knowledge-card:hover {
            border-color: rgba(100, 149, 237, 0.4);
        }

        .knowledge-header {
            background: linear-gradient(135deg, rgba(100, 149, 237, 0.1) 0%, rgba(30, 82, 130, 0.1) 100%);
            padding: 18px 20px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }

        .knowledge-header:hover {
            background: linear-gradient(135deg, rgba(100, 149, 237, 0.15) 0%, rgba(30, 82, 130, 0.15) 100%);
        }

        /* Dark mode: stronger gradient on knowledge headers */
        [data-theme="dark"] .knowledge-header {
            background: linear-gradient(135deg, rgba(100, 149, 237, 0.08) 0%, rgba(30, 58, 95, 0.15) 100%);
        }

        [data-theme="dark"] .knowledge-header:hover {
            background: linear-gradient(135deg, rgba(100, 149, 237, 0.15) 0%, rgba(30, 58, 95, 0.25) 100%);
        }

        .knowledge-header-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 16px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .category-icon {
            font-size: 22px;
        }

        .collapse-icon {
            font-size: 20px;
            color: #6495ED;
            transition: transform 0.3s ease;
        }

        .knowledge-card.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        .knowledge-content {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }

        .knowledge-card.collapsed .knowledge-content {
            max-height: 0;
            padding: 0 20px;
            overflow: hidden;
        }

        .knowledge-content p {
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .knowledge-content ul {
            margin-left: 20px;
            margin-bottom: 12px;
        }

        .knowledge-content li {
            font-size: 13px;
            line-height: 1.6;
            color: var(--text-secondary);
            margin-bottom: 6px;
        }

        .knowledge-content strong {
            color: var(--text-primary);
        }

        .pdf-link-section {
            margin-top: 20px;
            padding: 15px;
            background: rgba(100, 149, 237, 0.08);
            border-left: 4px solid #6495ED;
            border-radius: 6px;
        }

        .pdf-link-title {
            font-size: 12px;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .pdf-link {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: #6495ED;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 13px;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: 8px;
        }

        .pdf-link:hover {
            background: #4169E1;
            transform: translateX(3px);
            box-shadow: 0 4px 12px rgba(100, 149, 237, 0.3);
        }

        .pdf-icon {
            font-size: 16px;
        }

        .open-source-disclaimer {
            font-size: 11px;
            color: var(--text-muted);
            font-style: italic;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--card-border);
        }

        /* Scrollbar for knowledge content */
        .knowledge-content::-webkit-scrollbar {
            width: 8px;
        }

        .knowledge-content::-webkit-scrollbar-track {
            background: var(--article-bg);
            border-radius: 4px;
        }

        .knowledge-content::-webkit-scrollbar-thumb {
            background: var(--card-border);
            border-radius: 4px;
        }

        .knowledge-content::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Dark mode: cyber scrollbar */
        [data-theme="dark"] .knowledge-content::-webkit-scrollbar-thumb {
            background: #1e3a5f;
        }

        [data-theme="dark"] .knowledge-content::-webkit-scrollbar-thumb:hover {
            background: #6495ED;
        }

        /* RTL Support */
        [dir="rtl"] .pdf-link-section {
            border-left: none;
            border-right: 4px solid #6495ED;
        }

        /* Lebanon Map */
        .lebanon-map-section {
            background: var(--container-bg);
            border: 2px solid var(--card-border);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--card-glow);
            transition: background 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .lebanon-map-section h2 {
            font-size: 20px;
            margin-bottom: 15px;
            color: var(--text-primary);
            font-weight: bold;
            letter-spacing: 0.5px;
        }

        #lebanon-map {
            width: 100%;
            height: 450px;
            border-radius: 8px;
            border: 1px solid var(--card-border);
        }

        /* ============================================
           Responsive - v2.9.0: fixed extra brace
           ============================================ */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 20px;
                padding: 25px 20px;
            }
            
            .header-logo {
                width: 60px;
                height: 60px;
            }
            
            .header-content {
                text-align: center;
            }
            
            .header-controls {
                position: static;
                align-items: center;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .back-link {
                position: static;
                display: block;
                width: fit-content;
                margin: 0 auto 15px;
            }

            .knowledge-categories {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-status">
            <div class="loading-title">Loading Lebanon Stability Data</div>
            <div class="loading-steps" id="loadingSteps">
                <div class="loading-step active" id="step1">
                    <span class="step-icon">‚è≥</span>
                    <span>Fetching currency rates (LBP/USD)...</span>
                </div>
                <div class="loading-step" id="step2">
                    <span class="step-icon">‚è≥</span>
                    <span>Scraping Eurobond yields...</span>
                </div>
                <div class="loading-step" id="step3">
                    <span class="step-icon">‚è≥</span>
                    <span>Analyzing Hezbollah activity...</span>
                </div>
                <div class="loading-step" id="step4">
                    <span class="step-icon">‚è≥</span>
                    <span>Calculating stability score...</span>
                </div>
                <div class="loading-step" id="step5">
                    <span class="step-icon">‚è≥</span>
                    <span>Rendering dashboard...</span>
                </div>
            </div>
            <div class="loading-progress" id="loadingProgress">
                This may take 20-40 seconds...
            </div>
            <div class="loading-error" id="loadingError" style="display: none;">
                ‚ö†Ô∏è Loading is taking longer than expected. Please wait or refresh the page.
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <a href="index.html" class="back-link" data-i18n="backLink">‚Üê Back to Dashboard</a>
            
            <img src="https://raw.githubusercontent.com/SassAndSweet/asifah-analytics/main/Asifah_Analytics_1_25_26_V1_LOGO.png" alt="Asifah Analytics Logo" class="header-logo">
            
            <div class="header-content">
                <h1 data-i18n="pageTitle">üá±üáß LEBANON STABILITY INDEX</h1>
                <div class="subtitle" data-i18n="pageSubtitle">Multi-Factor Analysis: Political, Economic, Security & Hezbollah Status</div>
                <div class="last-updated" id="lastUpdated" data-i18n="lastUpdated">Last updated: Loading...</div>
            </div>
            
            <div class="header-controls">
                <div class="language-switcher">
                    <button class="lang-btn active" onclick="switchLanguage('en', this)">EN</button>
                    <button class="lang-btn" onclick="switchLanguage('he', this)">◊¢◊ë</button>
                    <button class="lang-btn" onclick="switchLanguage('ar', this)">ÿπ</button>
                    <!-- v2.9.0: Fixed - was showing Hebrew chars, now shows Farsi -->
                    <button class="lang-btn" onclick="switchLanguage('fa', this)">ŸÅÿß</button>
                </div>
                
                <div class="theme-toggle">
                    <span class="theme-toggle-label" data-i18n="themeToggle">Theme</span>
                    <div class="theme-toggle-switch" onclick="toggleTheme()">
                        <div class="theme-toggle-slider"></div>
                    </div>
                </div>
            </div>
        </header>

        <div id="content" style="display:none;">
            <!-- Overall Stability Index -->
            <div class="stability-index-card">
                <div class="stability-title" data-i18n="stabilityTitle">LEBANON STABILITY INDEX</div>
                <div class="stability-score" id="stabilityScore">--</div>
                <div class="stability-label" id="stabilityLabel">--</div>
                <div class="stability-bar">
                    <div class="stability-fill" id="stabilityFill"></div>
                </div>
                <div class="stability-legend" data-i18n="stabilityLegend">100 = Stable Regime | 0 = Imminent Collapse</div>
                <div class="sparkline-container" id="stabilitySparklineContainer">
                    <span class="sparkline-label">30-Day Trend:</span>
                    <canvas id="stabilitySparkline" class="sparkline-canvas"></canvas>
                    <span class="sparkline-status" id="stabilitySparklineStatus">Loading...</span>
                </div>
            </div>

            <!-- Metrics Grid -->
            <div class="metrics-grid">
                <!-- Government Status -->
                <div class="metric-card">
                    <div class="metric-title" data-i18n="govStatus">GOVERNMENT STATUS</div>
                    <div class="metric-value" id="presidentStatus">‚úÖ</div>
                    <div class="metric-subtitle" data-i18n="president">President: Joseph Aoun</div>
                    <div class="government-status">
                        <div class="government-status-item">
                            <span class="status-label">Prime Minister:</span>
                            <span class="status-value">Nawaf Salam</span>
                        </div>
                        <div class="government-status-item">
                            <span class="status-label">Speaker of Parliament:</span>
                            <span class="status-value">Nabih Berri</span>
                        </div>
                        <div class="government-status-item">
                            <span class="status-label" data-i18n="daysInOffice">Days in Office:</span>
                            <span class="status-value" id="daysWithPresident">--</span>
                        </div>
                        <div class="government-status-item">
                            <span class="status-label" data-i18n="elected">Elected:</span>
                            <span class="status-value">Jan 9, 2025</span>
                        </div>
                        <div class="government-status-item">
                            <span class="status-label" data-i18n="daysUntilElections">Days Until Elections:</span>
                            <span class="status-value" id="daysUntilElection">--</span>
                        </div>
                        <div class="government-status-item" style="font-size: 11px; color: var(--text-muted); margin-top: 8px;">
                            <span style="font-weight: 600;">May 10, 2026</span> (Decree No. 2438) 
                            <a href="https://today.lorientlejour.com/article/1493221/hajjar-sets-vote-for-may-3-diaspora-to-vote-1-week-earlier.html" 
                               target="_blank" 
                               style="color: #6495ED; text-decoration: none; margin-left: 4px;"
                               title="L'Orient Today - Official Election Decree">
                                üìÑ Source
                            </a>
                        </div>
                    </div>
                    <!-- Election News Scanner (inside gov card) -->
                    <div style="margin-top: 15px; padding-top: 12px; border-top: 1px solid var(--card-border);">
                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">
                            üó≥Ô∏è ELECTION NEWS
                        </div>
                        <div id="electionNewsContainer" style="font-size: 12px;">
                            <span style="color: var(--text-secondary); font-style: italic;">Loading...</span>
                        </div>
                    </div>
                </div>

                <!-- Currency Status -->
                <div class="metric-card">
                    <div class="metric-title" data-i18n="currency">CURRENCY (LBP/USD)</div>
                    <div class="metric-value" id="currencyRate">--</div>
                    <div class="metric-subtitle" id="currencyChange">--</div>
                    <div id="currencyTrend" style="margin-top:10px;"></div>
                    
                    <div class="sparkline-container" id="currencySparklineContainer" style="display:none;">
                        <span class="sparkline-label">30-Day:</span>
                        <canvas id="currencySparkline" class="sparkline-canvas"></canvas>
                        <span class="sparkline-status" id="currencySparklineStatus">Loading...</span>
                    </div>
                    
                    <!-- Gold Reserves Info -->
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--card-border);">
                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">
                            ü™ô GOLD RESERVES
                        </div>
                        
                        <div style="font-size: 18px; color: var(--text-primary); margin-bottom: 6px; font-weight: bold;">
                            <span id="goldValue">~$40-50B</span> USD
                        </div>
                        
                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">
                            286.8 tons ‚Ä¢ <span id="goldPrice">$2,750/oz</span>
                        </div>
                        
                        <div class="sparkline-container" id="goldSparklineContainer" style="display:none; margin-top: 8px;">
                            <span class="sparkline-label" style="font-size: 10px;">Gold Price (30d):</span>
                            <canvas id="goldSparkline" class="sparkline-canvas" style="max-width: 100px;"></canvas>
                            <span class="sparkline-status" id="goldSparklineStatus" style="font-size: 10px;">Loading...</span>
                        </div>
                        
                        <div style="font-size: 9px; color: var(--text-muted); line-height: 1.5; margin-top: 8px;">
                            2nd largest ME reserves ‚Ä¢ Protected by 1986 law ‚Ä¢ 
                            <span id="goldGdpPct">~200%</span> of GDP
                            <a href="https://www.euronews.com/business/2026/02/06/lebanons-424bn-gold-dilemma-a-crisis-lifeline-or-a-last-resort" 
                               target="_blank" 
                               style="color: #6495ED; text-decoration: none; margin-left: 4px;"
                               title="Euronews - Lebanon's Gold Reserves">
                                üìä
                            </a>
                        </div>
                    </div>
                </div>

               <!-- Bond Yields & Debt Status (v2.9.1 Enhanced) -->
                <div class="metric-card">
                    <div class="metric-title" data-i18n="bondYield">10Y EUROBOND YIELD</div>
                    <div style="display: flex; align-items: baseline; gap: 10px;">
                        <div class="metric-value" id="bondYield">--</div>
                        <span id="bondTrendArrow" style="font-size: 20px; font-weight: bold;">‚Üí</span>
                    </div>
                    <div class="metric-subtitle" id="bondChange" style="margin-bottom: 8px;">Sovereign default risk</div>
                    
                    <div class="sparkline-container" id="bondSparklineContainer" style="display:none;">
                        <span class="sparkline-label">30-Day:</span>
                        <canvas id="bondSparkline" class="sparkline-canvas"></canvas>
                        <span class="sparkline-status" id="bondSparklineStatus">Loading...</span>
                    </div>
                    
                    <!-- Default Timeline -->
                    <div style="margin-top: 12px; padding: 10px; background: var(--article-bg); border-radius: 8px; border-left: 3px solid #f87171;">
                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; font-weight: 600;">
                            ‚ö†Ô∏è SOVEREIGN DEFAULT
                        </div>
                        <div style="font-size: 13px; color: var(--text-primary); font-weight: 600;">
                            March 9, 2020 ‚Äî <span id="daysInDefault">--</span> days
                        </div>
                        <div style="font-size: 11px; color: var(--text-secondary); margin-top: 2px;">
                            $30B total defaulted Eurobond debt
                        </div>
                    </div>

                    <!-- Bond Price / Recovery -->
                    <div style="margin-top: 10px; padding: 10px; background: var(--article-bg); border-radius: 8px;">
                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; font-weight: 600;">
                            üí∞ EUROBOND PRICE
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: baseline;">
                            <span id="bondPriceCents" style="font-size: 22px; font-weight: bold; color: var(--text-primary);">--¬¢</span>
                            <span style="font-size: 11px; color: var(--text-secondary);">per $1 face value</span>
                        </div>
                        <div style="font-size: 10px; color: var(--text-muted); margin-top: 6px;">
                            Implied recovery: <span id="impliedRecovery" style="font-weight: 600;">--</span>%
                        </div>
                        <!-- Comparison bar -->
                        <div style="margin-top: 8px; font-size: 9px; color: var(--text-muted);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 2px;">
                                <span>üáªüá™ Venezuela 8¬¢</span>
                                <span>üá±üáß Lebanon <span id="bondCompLebanon">--</span>¬¢</span>
                                <span>üá¶üá∑ Argentina 35¬¢</span>
                                <span>üá±üá∞ Sri Lanka 50¬¢</span>
                            </div>
                            <div style="height: 6px; background: linear-gradient(90deg, #f87171 0%, #fb923c 30%, #facc15 60%, #4ade80 100%); border-radius: 3px; position: relative;">
                                <div id="bondPriceMarker" style="position: absolute; top: -3px; width: 12px; height: 12px; background: #6495ED; border-radius: 50%; border: 2px solid var(--card-bg); left: 40%;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Restructuring Status -->
                    <div style="margin-top: 10px; padding: 10px; background: var(--article-bg); border-radius: 8px;">
                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; font-weight: 600;">
                            üèõÔ∏è RESTRUCTURING STATUS
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span id="restructuringStatus" style="font-size: 14px; font-weight: bold; color: var(--text-primary);">Loading...</span>
                            <span id="restructuringIcon" style="font-size: 18px;">‚ö™</span>
                        </div>
                        <div style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">
                            IMF target: <span style="font-weight: 600;">End-2026</span>
                        </div>
                        <div style="font-size: 9px; color: var(--text-muted); margin-top: 6px; line-height: 1.4;">
                            GS scenarios ‚Äî Base: 28¬¢ | Bull: 40¬¢ | Bear: 17¬¢
                        </div>
                        <!-- Restructuring articles -->
                        <div id="restructuringArticles" style="margin-top: 8px;"></div>
                    </div>
                </div>

                <!-- Hezbollah Activity -->
                <div class="metric-card">
                    <div class="metric-title" data-i18n="hezbollahActivity">HEZBOLLAH ACTIVITY</div>
                    <div class="metric-value" id="hezbollahScore">--</div>
                    <div class="metric-subtitle" data-i18n="last30Days">Last 30 days</div>
                    <div class="sparkline-container" id="hezbollahSparklineContainer" style="display:none;">
                        <span class="sparkline-label">30-Day:</span>
                        <canvas id="hezbollahSparkline" class="sparkline-canvas"></canvas>
                        <span class="sparkline-status" id="hezbollahSparklineStatus">Loading...</span>
                    </div>
                    <div class="activity-grid">
                        <div class="activity-item">
                            <div class="activity-number" id="rearmamentCount">--</div>
                            <div class="activity-label" data-i18n="rearmamentReports">Rearmament Reports</div>
                            <div id="rearmamentLinks" style="margin-top:10px; font-size:0.8em;"></div>
                        </div>
                        <div class="activity-item">
                            <div class="activity-number" id="strikeCount">--</div>
                            <div class="activity-label" data-i18n="strikeMentions">Strike Mentions</div>
                            <div id="strikeLinks" style="margin-top:10px; font-size:0.8em;"></div>
                        </div>
                    </div>
                </div>

                <!-- Rhetoric Tracker (v1.1.0) -->
                <div class="metric-card" id="rhetoricCard">
                    <div class="metric-title" data-i18n="rhetoricTracker">RHETORIC TRACKER</div>
                    <div style="display: flex; align-items: baseline; gap: 10px;">
                        <div class="metric-value" id="rhetoricScore">--</div>
                        <span id="rhetoricTheatreLabel" style="font-size: 14px; font-weight: bold; padding: 3px 10px; border-radius: 4px; background: #6b7280; color: white;">--</span>
                    </div>
                    <div class="metric-subtitle" data-i18n="rhetoricSubtitle">Theatre escalation level</div>
                    
                    <!-- Actor Escalation Grid -->
                    <div id="rhetoricActors" style="margin-top: 12px;">
                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; font-weight: 600;">
                            üéØ <span data-i18n="actorStatus">ACTOR STATUS</span>
                        </div>
                        <div id="rhetoricActorList" style="font-size: 12px;">
                            <span style="color: var(--text-secondary); font-style: italic;">Loading...</span>
                        </div>
                    </div>
                    
                    <!-- Alerts Banner -->
                    <div id="rhetoricAlerts" style="margin-top: 12px; display: none;">
                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; font-weight: 600;">
                            üö® <span data-i18n="activeAlerts">ACTIVE ALERTS</span>
                        </div>
                        <div id="rhetoricAlertList"></div>
                    </div>
                    
                    <!-- Spokespersons Detected -->
                    <div id="rhetoricSpokespeople" style="margin-top: 12px; display: none;">
                        <div style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; font-weight: 600;">
                            üé§ <span data-i18n="voicesDetected">VOICES DETECTED</span>
                        </div>
                        <div id="rhetoricSpokesList" style="font-size: 11px; color: var(--text-secondary);"></div>
                    </div>
                    
                    <!-- Link to full analysis -->
                    <div style="margin-top: 15px; padding-top: 12px; border-top: 1px solid var(--card-border); text-align: center;">
                        <a href="rhetoric.html" style="color: #6495ED; text-decoration: none; font-size: 12px; font-weight: 600;" data-i18n="viewFullAnalysis">
                            View Full Rhetoric Analysis ‚Üí
                        </a>
                    </div>
                    
                    <!-- Scan info -->
                    <div id="rhetoricScanInfo" style="margin-top: 8px; font-size: 10px; color: var(--text-muted); text-align: center;">
                        --
                    </div>
                </div>
            </div>

            <!-- Lebanon Map -->
            <div class="lebanon-map-section">
                <h2>üó∫Ô∏è Map of Lebanon</h2>
                <div id="lebanon-map"></div>
            </div>

            <!-- Knowledge Library Section -->
            <div class="knowledge-library">
                <h2>
                    <span class="library-icon">üìö</span>
                    <span data-i18n="knowledgeLibraryTitle">Knowledge Library</span>
                </h2>
                <p class="open-source-disclaimer">
                    Note: Background information is compiled from open-source research and analysis. For detailed assessments, see linked one-pager documents below.
                </p>
                
                <div class="knowledge-categories">
                    <!-- Security & Hezbollah Dynamics -->
                    <div class="knowledge-card collapsed" id="card-security">
                        <div class="knowledge-header" onclick="toggleKnowledgeCard('security')">
                            <div class="knowledge-header-title">
                                <span class="category-icon">‚öîÔ∏è</span>
                                <span data-i18n="catSecurity">Security & Hezbollah Dynamics</span>
                            </div>
                            <span class="collapse-icon">‚ñº</span>
                        </div>
                        <div class="knowledge-content">
                            <p><strong>Hezbollah's Military Capabilities:</strong> Despite the November 2024 ceasefire with Israel, Hezbollah maintains significant military infrastructure in southern Lebanon. The group possesses an estimated arsenal of precision-guided missiles, anti-tank weapons, and drone capabilities developed with Iranian support.</p>
                            
                            <p><strong>Israeli Strikes & Ceasefire Violations:</strong> Israel conducts periodic airstrikes targeting alleged Hezbollah weapons depots and rearmament activities, citing violations of UNSCR 1701. These operations raise tensions and test the fragile ceasefire arrangements established post-conflict.</p>

                            <p><strong>UNIFIL Withdrawal:</strong> The United Nations Interim Force in Lebanon (UNIFIL) is drawing down operations, with most peacekeepers scheduled to leave by 2027. This withdrawal creates a security vacuum along the Blue Line, raising concerns about border monitoring and conflict prevention capabilities.</p>

                            <p><strong>Southern Border Security:</strong> The Lebanese Armed Forces (LAF) face challenges asserting authority in southern regions historically controlled by Hezbollah. Limited resources, sectarian considerations, and Hezbollah's parallel security apparatus complicate efforts to establish unified state control.</p>

                            <p><strong>Rearmament Concerns:</strong> Intelligence reports indicate ongoing weapons transfers from Syria to Hezbollah positions in Lebanon. Western officials cite evidence of arms smuggling through official border crossings and unofficial routes, potentially rebuilding Hezbollah's military capacity faster than the LAF can monitor.</p>

                            <div class="pdf-link-section">
                                <div class="pdf-link-title">üìÑ Detailed Analysis:</div>
                                <a href="hizballah-financing.html" class="pdf-link">
                                    <span class="pdf-icon">üìë</span>
                                    <span>Hizballah Financing One-Pager</span>
                                </a>
                                <p class="open-source-disclaimer">Comprehensive assessment of Hezbollah's financial networks, revenue sources, and economic influence in Lebanon.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Economic & Financial Collapse -->
                    <div class="knowledge-card collapsed" id="card-economic">
                        <div class="knowledge-header" onclick="toggleKnowledgeCard('economic')">
                            <div class="knowledge-header-title">
                                <span class="category-icon">üí∞</span>
                                <span data-i18n="catEconomic">Economic & Financial Collapse</span>
                            </div>
                            <span class="collapse-icon">‚ñº</span>
                        </div>
                        <div class="knowledge-content">
                            <p><strong>Currency Crisis:</strong> The Lebanese pound has collapsed from 1,500 LBP/USD (official rate) to over 89,000 LBP/USD on the black market, representing a 98% devaluation. This hyperinflation has wiped out savings, destroyed purchasing power, and created multiple exchange rates that complicate economic activity.</p>
                            
                            <p><strong>Banking Sector Failure:</strong> Lebanon's banking system effectively collapsed in 2019, imposing severe capital controls that prevent depositors from accessing their savings. Banks hold an estimated $70 billion in trapped deposits, with many accounts denominated in now-worthless Lebanese pounds or subject to arbitrary "haircuts" on dollar withdrawals.</p>

                            <p><strong>Gold Reserves - Strategic Asset:</strong></p>
                            <ul>
                                <li><strong>Holdings:</strong> Lebanon possesses 286.8 metric tons of gold, the second-largest reserves in the Middle East after Saudi Arabia</li>
                                <li><strong>Current Value:</strong> See live valuation in the Currency card above (updated dynamically from spot gold prices)</li>
                                <li><strong>GDP Comparison:</strong> Gold reserves represent over 100% of Lebanon's estimated $20 billion GDP ‚Äî see live percentage above</li>
                                <li><strong>Legal Protection:</strong> Protected by 1986 law requiring parliamentary approval for sale; 60% stored in Beirut vaults, 40% in United States</li>
                                <li><strong>Political Debate:</strong> Ongoing disputes over whether to sell gold to fund government operations, restructure debt, or maintain as strategic reserve</li>
                            </ul>

                            <p><strong>Sovereign Default:</strong> Lebanon defaulted on its Eurobond debt in March 2020, becoming the first Middle Eastern country to default on sovereign bonds. Negotiations with creditors remain stalled, with 10-year Eurobond yields trading at distressed levels (~45%) reflecting markets' expectation of substantial haircuts on principal.</p>

                            <p><strong>Informal Economy & Smuggling:</strong> The formal economy has contracted dramatically, with GDP falling from $55 billion (2018) to an estimated $20 billion (2025). The informal economy now dominates, including fuel smuggling to Syria, captagon production and trafficking, and various black market activities that generate revenue outside state control.</p>

                            <div class="pdf-link-section">
                                <div class="pdf-link-title">üìÑ Detailed Analysis:</div>
                                <a href="captagon-trade.html" class="pdf-link">
                                    <span class="pdf-icon">üìë</span>
                                    <span>Captagon Trade - Lebanon Focus</span>
                                </a>
                                <p class="open-source-disclaimer">Analysis of captagon production networks in Lebanon, trafficking routes, and economic impact of the illicit drug trade.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Governance & Political Stability -->
                    <div class="knowledge-card collapsed" id="card-governance">
                        <div class="knowledge-header" onclick="toggleKnowledgeCard('governance')">
                            <div class="knowledge-header-title">
                                <span class="category-icon">üèõÔ∏è</span>
                                <span data-i18n="catGovernance">Governance & Political Stability</span>
                            </div>
                            <span class="collapse-icon">‚ñº</span>
                        </div>
                        <div class="knowledge-content">
                            <p><strong>Presidential Election (2025):</strong> After a 26-month presidential vacancy, Lebanon elected Joseph Aoun as president on January 9, 2025. A former Lebanese Armed Forces commander, Aoun's election broke a prolonged deadlock but faces challenges building consensus across deeply fractured sectarian political blocs.</p>
                            
                            <p><strong>Parliamentary Elections (May 2026):</strong> Lebanon's next parliamentary elections are scheduled for May 10, 2026 (Decree No. 2438). These elections will test whether reform-oriented candidates can challenge entrenched sectarian parties, or if traditional political elites maintain their grip on power despite the economic crisis.</p>

                            <p><strong>Sectarian Power-Sharing System:</strong></p>
                            <ul>
                                <li><strong>Confessional Model:</strong> Lebanon's political system allocates positions by religious sect (Maronite president, Sunni prime minister, Shia speaker of parliament)</li>
                                <li><strong>Paralysis:</strong> Consensus requirements across sectarian lines often result in prolonged government formation crises and policy gridlock</li>
                                <li><strong>Reform Challenges:</strong> Efforts to reduce sectarianism face resistance from established parties whose power bases depend on maintaining confessional structures</li>
                                <li><strong>Hezbollah's Veto:</strong> Hezbollah and allied parties hold effective veto power over government decisions, particularly on security and foreign policy issues</li>
                            </ul>

                            <p><strong>Government Formation Challenges:</strong> Even after presidential elections, forming a functioning cabinet typically takes months of negotiation. Disputes over ministerial portfolios, policy programs, and Hezbollah's weapons regularly stall government formation, leaving caretaker administrations unable to implement major reforms.</p>

                            <p><strong>Judicial Independence:</strong> Lebanon's judiciary faces severe challenges including political interference, resource constraints, and allegations of corruption. The judicial council investigating the 2020 Beirut port explosion has faced repeated obstruction, highlighting the difficulty of holding powerful political actors accountable.</p>

                            <p><strong>State Capacity Erosion:</strong> Years of economic crisis, corruption, and brain drain have hollowed out state institutions. Public services have degraded dramatically, with ministries unable to pay salaries, maintain infrastructure, or deliver basic services, further undermining public trust in government.</p>
                        </div>
                    </div>

                    <!-- Regional & External Influence -->
                    <div class="knowledge-card collapsed" id="card-regional">
                        <div class="knowledge-header" onclick="toggleKnowledgeCard('regional')">
                            <div class="knowledge-header-title">
                                <span class="category-icon">üåç</span>
                                <span data-i18n="catRegional">Regional & External Influence</span>
                            </div>
                            <span class="collapse-icon">‚ñº</span>
                        </div>
                        <div class="knowledge-content">
                            <p><strong>Iranian Support to Hezbollah:</strong> Iran provides Hezbollah with estimated hundreds of millions of dollars annually in financial support, weapons, and training. This relationship makes Hezbollah a key component of Iran's regional deterrence strategy and "axis of resistance," while giving Tehran significant influence over Lebanese politics.</p>
                            
                            <p><strong>Syrian Instability Spillover:</strong></p>
                            <ul>
                                <li><strong>Refugee Crisis:</strong> Lebanon hosts approximately 1.5 million Syrian refugees, representing nearly 25% of Lebanon's population and straining already degraded public services</li>
                                <li><strong>Border Security:</strong> The porous Syrian-Lebanese border facilitates weapons smuggling, captagon trafficking, and movement of armed actors between the two countries</li>
                                <li><strong>Post-Assad Dynamics:</strong> Syria's ongoing instability following the Assad regime's collapse (2024) has complicated Lebanon's security calculations and Hezbollah's supply lines</li>
                            </ul>

                            <p><strong>Gulf Arab Relations:</strong> Saudi Arabia and other Gulf states historically provided Lebanon with financial support and investment. However, tensions over Hezbollah's role in regional conflicts led to a gradual withdrawal of Gulf engagement. Recent diplomatic overtures suggest cautious re-engagement, but conditional on addressing Hezbollah's influence.</p>

                            <p><strong>US Sanctions & Caesar Act:</strong></p>
                            <ul>
                                <li><strong>Hezbollah Sanctions:</strong> Extensive US Treasury designations target Hezbollah's financial networks, businesses, and individual operatives</li>
                                <li><strong>Caesar Act:</strong> US sanctions on Syria complicate Lebanon's economic ties with its neighbor, particularly regarding energy imports and border trade</li>
                                <li><strong>Banking Restrictions:</strong> International banks' de-risking has further isolated Lebanon's financial sector from global markets</li>
                                <li><strong>Humanitarian Exemptions:</strong> Some sanctions include exemptions for humanitarian aid, though implementation challenges remain</li>
                            </ul>

                            <p><strong>French Diplomatic Engagement:</strong> France, Lebanon's former colonial power, maintains active diplomatic involvement. French initiatives have included hosting donor conferences, mediating political negotiations, and providing humanitarian assistance. However, French leverage remains limited without Lebanese political consensus on reforms.</p>

                            <p><strong>International Donor Conditionality:</strong> International financial institutions and donor countries condition reconstruction aid on implementing anti-corruption measures, restructuring the banking sector, and reducing Hezbollah's influence. Lebanon's failure to meet these conditions has left billions in pledged aid largely undisbursed.</p>
                        </div>
                    </div>

                    <!-- Structural Risk Indicators -->
                    <div class="knowledge-card collapsed" id="card-structural">
                        <div class="knowledge-header" onclick="toggleKnowledgeCard('structural')">
                            <div class="knowledge-header-title">
                                <span class="category-icon">üìà</span>
                                <span data-i18n="catStructural">Structural Risk Indicators</span>
                            </div>
                            <span class="collapse-icon">‚ñº</span>
                        </div>
                        <div class="knowledge-content">
                            <p><strong>Electricity Crisis:</strong> Lebanon's national electricity company (EDL) provides only 2-4 hours of power daily in many areas. Citizens rely on expensive private generators, with fuel costs consuming significant portions of household budgets. The electricity crisis reflects broader state failure, corruption in the energy sector, and inability to maintain basic infrastructure.</p>
                            
                            <p><strong>Water Infrastructure Collapse:</strong></p>
                            <ul>
                                <li><strong>Access:</strong> Only 50-60% of population has reliable access to piped water; many rely on private water trucks</li>
                                <li><strong>Quality:</strong> Degraded treatment facilities and aging pipes compromise water quality and public health</li>
                                <li><strong>Management:</strong> Weak regulatory oversight and political interference have prevented necessary investments in water infrastructure</li>
                            </ul>

                            <p><strong>Healthcare System Degradation:</strong> Lebanon's once-strong healthcare system has collapsed under economic pressures. Many hospitals operate at minimal capacity due to medicine shortages, fuel for generators, and emigration of medical professionals. The brain drain has particularly affected specialized medical care and emergency services.</p>

                            <p><strong>Brain Drain & Emigration:</strong> An estimated 200,000+ Lebanese have emigrated since 2019, primarily young professionals and skilled workers. This exodus includes doctors, engineers, IT specialists, and entrepreneurs seeking opportunities abroad. The loss of human capital further undermines Lebanon's recovery prospects and hollows out professional sectors.</p>

                            <p><strong>Poverty & Food Insecurity:</strong></p>
                            <ul>
                                <li><strong>Poverty Rate:</strong> Over 80% of population now lives below the poverty line, up from 28% in 2019</li>
                                <li><strong>Food Security:</strong> Lebanon imports 80% of food; currency collapse has made basic goods unaffordable for many families</li>
                                <li><strong>Malnutrition:</strong> Rising rates of malnutrition, particularly among children, as families cut meals and nutritional quality</li>
                                <li><strong>Humanitarian Aid:</strong> International organizations provide essential support, but demand far exceeds available assistance</li>
                            </ul>

                            <p><strong>Education Crisis:</strong> Public schools lack basic resources, with teacher strikes common due to salary devaluation. Private schools, historically preferred by middle-class families, have become unaffordable. School attendance rates have dropped, and educational quality has declined significantly, threatening future human capital development.</p>

                            <p><strong>Social Safety Net Collapse:</strong> Lebanon has no functional social safety net. The absence of unemployment insurance, adequate pension systems, or comprehensive public assistance leaves vulnerable populations completely exposed to economic shocks. This vulnerability increases social tensions and potential for unrest.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Hezbollah-Related Articles -->
            <div class="articles-section">
                <div class="section-title" data-i18n="recentArticles">üì∞ Recent Hezbollah & Security Articles (Last 30 Days)</div>
                <div id="articlesContainer"></div>
            </div>
        </div>

        <footer>
            <div>Data Sources: ExchangeRate-API, Trading Economics, Google News, UNIFIL Reports</div>
            <div style="margin-top:15px; font-size:0.85em;">
                NewsAPI for aggregating news sources, GDELT for Arabic, Hebrew, and Farsi content. Reddit for community intelligence, plus other OSINT sources.
            </div>
            <div style="margin-top:15px;">For inquiries, contact: <a href="mailto:asifahanalytics@gmail.com" style="color:#6495ED;">asifahanalytics@gmail.com</a></div>
            
            <div style="margin-top:25px; padding:15px; background:var(--article-bg); border-radius:8px;">
                <div style="font-size:0.9em; margin-bottom:8px;">Asifah Analytics v2.9.0</div>
                <div style="font-size:0.8em;">Updated every 30 minutes | Not for operational use</div>
            </div>

            <div style="margin-top:20px; padding:15px; background:rgba(139,0,0,0.2); border-radius:8px;">
                <span style="font-size:0.9em;">
                    If you find Asifah Analytics useful and want to support ongoing development, you can 
                    <a href="https://www.buymeacoffee.com/asifahanalytics" target="_blank" style="color:#6495ED;">‚òï buy me a coffee</a>
                </span>
            </div>

            <div style="margin-top:25px; font-size:0.75em; color:var(--text-muted);">
                ¬© 2025 RCGG. All Rights Reserved. Proprietary and Confidential.<br>
                Unauthorized use, reproduction, or distribution prohibited.
            </div>
        </footer>
    </div>

    <script>
        const LEBANON_BACKEND_URL = 'https://lebanon-stability-backend.onrender.com';

        // Theme Management
        function initTheme() {
            const savedTheme = localStorage.getItem('asifah-theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('asifah-theme', newTheme);
        }

        initTheme();

        // Loading Overlay Management
        let loadingStepIndex = 0;
        let loadingInterval = null;
        let loadingTimeout = null;

        function startLoadingProgress() {
            const steps = ['step1', 'step2', 'step3', 'step4', 'step5'];
            
            loadingInterval = setInterval(() => {
                if (loadingStepIndex < steps.length - 1) {
                    const currentStep = document.getElementById(steps[loadingStepIndex]);
                    if (currentStep) {
                        currentStep.classList.remove('active');
                        currentStep.classList.add('complete');
                        currentStep.querySelector('.step-icon').textContent = '‚úì';
                    }
                    
                    loadingStepIndex++;
                    const nextStep = document.getElementById(steps[loadingStepIndex]);
                    if (nextStep) {
                        nextStep.classList.add('active');
                    }
                }
            }, 8000);
            
            loadingTimeout = setTimeout(() => {
                document.getElementById('loadingError').style.display = 'block';
            }, 60000);
        }

        function hideLoadingOverlay() {
            if (loadingInterval) clearInterval(loadingInterval);
            if (loadingTimeout) clearTimeout(loadingTimeout);
            
            document.querySelectorAll('.loading-step').forEach(step => {
                step.classList.remove('active');
                step.classList.add('complete');
                step.querySelector('.step-icon').textContent = '‚úì';
            });
            
            setTimeout(() => {
                const overlay = document.getElementById('loadingOverlay');
                if (overlay) {
                    overlay.classList.add('hidden');
                }
            }, 500);
        }

        // Fetch trend data for sparklines
        async function loadTrendData() {
            try {
                const response = await fetch(`${LEBANON_BACKEND_URL}/api/lebanon-trends?days=30`);
                const data = await response.json();
                
                if (data.success && data.days_collected >= 3) {
                    createSparklines(data.trends);
                } else {
                    document.getElementById('stabilitySparklineStatus').textContent = 
                        `Building... (${data.days_collected}/3 days)`;
                    
                    if (data.days_collected > 0) {
                        document.getElementById('stabilitySparklineContainer').style.display = 'flex';
                    }
                }
            } catch (error) {
                console.error('Error loading trend data:', error);
                document.getElementById('stabilitySparklineStatus').textContent = 'No trend data';
            }
        }

        // Create sparkline charts
        function createSparklines(trends) {
            const commonOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false }, tooltip: { enabled: false } },
                scales: { x: { display: false }, y: { display: false } },
                elements: { point: { radius: 0 }, line: { tension: 0.4, borderWidth: 2 } }
            };

            // Stability Sparkline
            if (trends.stability && trends.stability.length > 0) {
                const ctx = document.getElementById('stabilitySparkline');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: trends.dates,
                        datasets: [{
                            data: trends.stability,
                            borderColor: '#6495ED',
                            backgroundColor: 'rgba(100, 149, 237, 0.1)',
                            fill: true
                        }]
                    },
                    options: commonOptions
                });
                
                const latest = trends.stability[trends.stability.length - 1];
                const previous = trends.stability[trends.stability.length - 2] || latest;
                const change = latest - previous;
                const arrow = change > 0 ? '‚Üë' : change < 0 ? '‚Üì' : '‚Üí';
                const color = change > 0 ? '#4ade80' : change < 0 ? '#f87171' : '#7a9ab8';
                
                document.getElementById('stabilitySparklineStatus').innerHTML = 
                    `<span style="color:${color}">${arrow} ${Math.abs(change).toFixed(1)}</span>`;
                document.getElementById('stabilitySparklineContainer').style.display = 'flex';
            }

            // Currency Sparkline
            if (trends.currency && trends.currency.length > 0) {
                const ctx = document.getElementById('currencySparkline');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: trends.dates,
                        datasets: [{
                            data: trends.currency,
                            borderColor: '#f87171',
                            backgroundColor: 'rgba(248, 113, 113, 0.1)',
                            fill: true
                        }]
                    },
                    options: commonOptions
                });
                
                const latest = trends.currency[trends.currency.length - 1];
                const previous = trends.currency[trends.currency.length - 2] || latest;
                const change = ((latest - previous) / previous * 100).toFixed(1);
                const arrow = change > 0 ? '‚ñº' : change < 0 ? '‚ñ≤' : '‚Üí';
                
                document.getElementById('currencySparklineStatus').innerHTML = 
                    `<span style="color:#f87171">${arrow} ${Math.abs(change)}%</span>`;
                document.getElementById('currencySparklineContainer').style.display = 'flex';
            }

            // Bond Sparkline
            if (trends.bonds && trends.bonds.length > 0) {
                const ctx = document.getElementById('bondSparkline');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: trends.dates,
                        datasets: [{
                            data: trends.bonds,
                            borderColor: '#fb923c',
                            backgroundColor: 'rgba(251, 146, 60, 0.1)',
                            fill: true
                        }]
                    },
                    options: commonOptions
                });
                
                const latest = trends.bonds[trends.bonds.length - 1];
                const previous = trends.bonds[trends.bonds.length - 2] || latest;
                const change = (latest - previous).toFixed(1);
                const arrow = change > 0 ? '‚Üë' : change < 0 ? '‚Üì' : '‚Üí';
                
                document.getElementById('bondSparklineStatus').innerHTML = 
                    `<span style="color:#fb923c">${arrow} ${Math.abs(change)}%</span>`;
                document.getElementById('bondSparklineContainer').style.display = 'flex';
            }

            // Hezbollah Activity Sparkline
            if (trends.hezbollah && trends.hezbollah.length > 0) {
                const ctx = document.getElementById('hezbollahSparkline');
                const last7 = {
                    dates: trends.dates.slice(-7),
                    data: trends.hezbollah.slice(-7)
                };
                
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: last7.dates,
                        datasets: [{
                            data: last7.data,
                            borderColor: '#facc15',
                            backgroundColor: 'rgba(250, 204, 21, 0.1)',
                            fill: true
                        }]
                    },
                    options: commonOptions
                });
                
                const latest = last7.data[last7.data.length - 1];
                const previous = last7.data[last7.data.length - 2] || latest;
                const change = latest - previous;
                const arrow = change > 0 ? '‚Üë' : change < 0 ? '‚Üì' : '‚Üí';
                const color = change > 0 ? '#f87171' : change < 0 ? '#4ade80' : '#7a9ab8';
                
                document.getElementById('hezbollahSparklineStatus').innerHTML = 
                    `<span style="color:${color}">${arrow} ${Math.abs(change).toFixed(0)}</span>`;
                document.getElementById('hezbollahSparklineContainer').style.display = 'flex';
            }

            // Gold Price Sparkline
            if (trends.gold_price && trends.gold_price.length > 0) {
                const ctx = document.getElementById('goldSparkline');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: trends.dates,
                        datasets: [{
                            data: trends.gold_price,
                            borderColor: '#fbbf24',
                            backgroundColor: 'rgba(251, 191, 36, 0.1)',
                            fill: true
                        }]
                    },
                    options: commonOptions
                });
                
                const latest = trends.gold_price[trends.gold_price.length - 1];
                const previous = trends.gold_price[trends.gold_price.length - 2] || latest;
                const change = ((latest - previous) / previous * 100).toFixed(1);
                const arrow = change > 0 ? '‚Üë' : change < 0 ? '‚Üì' : '‚Üí';
                const color = change > 0 ? '#4ade80' : change < 0 ? '#f87171' : '#7a9ab8';
                
                document.getElementById('goldSparklineStatus').innerHTML = 
                    `<span style="color:${color}">${arrow} ${Math.abs(change)}%</span>`;
                document.getElementById('goldSparklineContainer').style.display = 'flex';
            }
        }

        async function loadLebanonData() {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);
                
                const response = await fetch(`${LEBANON_BACKEND_URL}/scan-lebanon-stability`, {
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const text = await response.text();
                const data = JSON.parse(text);
                
                if (!data.success) {
                    throw new Error(data.error || 'Unknown error');
                }
                
                displayData(data);
                await loadTrendData();
                loadElectionNews();
                loadRhetoricData();
                hideLoadingOverlay();
                setTimeout(() => { initLebanonMap(); }, 300);
                
            } catch (error) {
                console.error('Error loading Lebanon data:', error);
                
                let errorMessage = error.message;
                if (error.name === 'AbortError') {
                    errorMessage = 'Request timeout (30 seconds) - backend may be slow';
                }
                
                document.getElementById('loadingProgress').textContent = 'Error loading data. Please refresh the page.';
                document.getElementById('loadingError').innerHTML = `‚ö†Ô∏è ${errorMessage}`;
                document.getElementById('loadingError').style.display = 'block';
            }
        }

        function displayData(data) {
            document.getElementById('content').style.display = 'block';
            
            document.getElementById('lastUpdated').textContent = 
                `Last updated: ${new Date().toLocaleString('en-US', { 
                    month: 'short', day: 'numeric', year: 'numeric', 
                    hour: 'numeric', minute: '2-digit', hour12: true 
                })}`;
            
            // Overall Stability
            const stability = data.stability || {};
            const score = stability.score || 0;
            const riskLevel = stability.risk_level || 'Unknown';
            const riskColor = stability.risk_color || 'red';
            
            document.getElementById('stabilityScore').textContent = `${score}/100`;
            document.getElementById('stabilityScore').className = `stability-score ${riskColor}`;
            document.getElementById('stabilityLabel').textContent = riskLevel;
            document.getElementById('stabilityLabel').className = `stability-label ${riskColor}`;
            document.getElementById('stabilityFill').style.width = `${score}%`;
            
            // Government Status
            const govt = data.government || {};
            if (govt.has_president) {
                document.getElementById('daysWithPresident').textContent = govt.days_with_president || '0';
            }
            
            const electionDate = new Date('2026-05-10T00:00:00');
            const today = new Date();
            const daysUntil = Math.ceil((electionDate - today) / (1000 * 60 * 60 * 24));
            document.getElementById('daysUntilElection').textContent = govt.days_until_election || daysUntil;
            
            // Currency
            const currency = data.currency || {};
            if (currency.usd_to_lbp) {
                const rate = currency.usd_to_lbp.toLocaleString('en-US', {maximumFractionDigits: 0});
                document.getElementById('currencyRate').textContent = rate;
                
                const devalPct = currency.devaluation_pct || 0;
                document.getElementById('currencyChange').textContent = 
                    `${devalPct > 0 ? '+' : ''}${devalPct.toFixed(0)}% vs official rate`;
                document.getElementById('currencyChange').style.color = '#f87171';
                
                const change24h = currency.change_24h || 0;
                const pressure = currency.pressure || 'NEUTRAL';
                
                let trendIcon, trendText, trendColor;
                if (Math.abs(change24h) < 0.01) {
                    trendIcon = '‚û°Ô∏è';
                    trendText = 'NO CHANGE';
                    trendColor = '#7a9ab8';
                } else if (change24h > 0) {
                    trendIcon = '‚¨áÔ∏è';
                    trendText = 'WEAKENING';
                    trendColor = '#f87171';
                } else {
                    trendIcon = '‚¨ÜÔ∏è';
                    trendText = 'STRENGTHENING';
                    trendColor = '#4ade80';
                }
                
                const pressureIcon = pressure === 'SELLING' ? 'üìâ' : (pressure === 'BUYING' ? 'üìà' : '‚îÅ');
                
                document.getElementById('currencyTrend').innerHTML = `
                    <div style="color:${trendColor}; font-size:0.95em; font-weight:700; margin-bottom: 4px;">
                        ${trendIcon} ${trendText} ${Math.abs(change24h).toFixed(2)}% (24h)
                    </div>
                    <div style="font-size:0.85em; color:var(--text-secondary); margin-top:3px;">
                        ${pressureIcon} ${pressure} PRESSURE
                    </div>
                `;
            }

            // Gold Reserves
            const gold = data.gold_reserves || {};
            if (gold.total_value_billions) {
                document.getElementById('goldValue').textContent = gold.display_value || `$${gold.total_value_billions}B`;
                
                if (gold.price_per_oz) {
                    document.getElementById('goldPrice').textContent = 
                        `$${gold.price_per_oz.toLocaleString('en-US', {maximumFractionDigits: 0})}/oz`;
                }
                
                if (gold.gdp_percentage) {
                    document.getElementById('goldGdpPct').textContent = `~${gold.gdp_percentage}%`;
                }
            }

            // Bonds (v2.9.1 enhanced)
            const bonds = data.bonds || {};
            if (bonds.yield) {
                document.getElementById('bondYield').textContent = `${bonds.yield.toFixed(1)}%`;
            } else {
                document.getElementById('bondYield').textContent = 'N/A';
            }
            
            // Yield trend arrow
            if (bonds.yield_arrow) {
                const arrowEl = document.getElementById('bondTrendArrow');
                arrowEl.textContent = bonds.yield_arrow;
                const arrowColor = bonds.yield_trend === 'rising' ? '#f87171' : 
                                   bonds.yield_trend === 'falling' ? '#4ade80' : '#7a9ab8';
                arrowEl.style.color = arrowColor;
                
                const changeText = bonds.yield_change ? 
                    `${bonds.yield_arrow} ${Math.abs(bonds.yield_change).toFixed(1)}% (24h) ‚Ä¢ ${bonds.source}` :
                    `Sovereign default risk ‚Ä¢ ${bonds.source}`;
                document.getElementById('bondChange').textContent = changeText;
            }
            
            // Default timeline
            if (bonds.days_in_default) {
                document.getElementById('daysInDefault').textContent = bonds.days_in_default.toLocaleString();
            }
            
            // Bond price
            if (bonds.eurobond_price_cents) {
                document.getElementById('bondPriceCents').textContent = `${bonds.eurobond_price_cents}¬¢`;
                document.getElementById('impliedRecovery').textContent = bonds.implied_recovery_pct;
                document.getElementById('bondCompLebanon').textContent = bonds.eurobond_price_cents;
                
                // Position the marker on the comparison bar (0-60 cent range)
                const markerPct = Math.min(Math.max((bonds.eurobond_price_cents / 60) * 100, 2), 98);
                document.getElementById('bondPriceMarker').style.left = `${markerPct}%`;
            }
            
            // Restructuring status
            if (bonds.restructuring) {
                const r = bonds.restructuring;
                document.getElementById('restructuringStatus').textContent = r.status || 'Unknown';
                document.getElementById('restructuringIcon').textContent = r.icon || '‚ö™';
                
                // Restructuring articles
                if (r.articles && r.articles.length > 0) {
                    document.getElementById('restructuringArticles').innerHTML = r.articles.slice(0, 3).map(a => `
                        <div style="margin-top: 4px;">
                            <a href="${a.url}" target="_blank" style="color: #6495ED; text-decoration: none; font-size: 0.8em;">
                                ‚Üí ${a.title ? a.title.substring(0, 55) + (a.title.length > 55 ? '...' : '') : 'Article'}
                            </a>
                        </div>
                    `).join('');
                }
            }
            
            // Hezbollah Activity
            const hezbollah = data.hezbollah || {};
            const activityScore = hezbollah.activity_score || 0;
            document.getElementById('hezbollahScore').textContent = `${activityScore}/100`;
            document.getElementById('rearmamentCount').textContent = hezbollah.rearmament_mentions || 0;
            document.getElementById('strikeCount').textContent = hezbollah.strike_mentions || 0;
            
            const articles = hezbollah.articles || [];
            
            const rearmamentArticles = articles.filter(a => 
                a.keyword && (a.keyword.toLowerCase().includes('rearmament') || a.keyword.toLowerCase().includes('weapons'))
            ).slice(0, 3);
            
            const strikeArticles = articles.filter(a => 
                a.keyword && a.keyword.toLowerCase().includes('strike')
            ).slice(0, 3);
            
            const rearmamentLinksContainer = document.getElementById('rearmamentLinks');
            if (rearmamentArticles.length > 0) {
                rearmamentLinksContainer.innerHTML = rearmamentArticles.map(article => `
                    <div style="margin-top:5px;">
                        <a href="${article.url}" target="_blank" style="color:#6495ED; text-decoration:none; font-size:0.85em;">
                            ‚Üí ${article.title ? article.title.substring(0, 60) + (article.title.length > 60 ? '...' : '') : 'Article'}
                        </a>
                    </div>
                `).join('');
            }
            
            const strikeLinksContainer = document.getElementById('strikeLinks');
            if (strikeArticles.length > 0) {
                strikeLinksContainer.innerHTML = strikeArticles.map(article => `
                    <div style="margin-top:5px;">
                        <a href="${article.url}" target="_blank" style="color:#6495ED; text-decoration:none; font-size:0.85em;">
                            ‚Üí ${article.title ? article.title.substring(0, 60) + (article.title.length > 60 ? '...' : '') : 'Article'}
                        </a>
                    </div>
                `).join('');
            }
            
            // Articles section
            const articlesContainer = document.getElementById('articlesContainer');
            
            if (articles.length === 0) {
                articlesContainer.innerHTML = '<div style="text-align:center; color:var(--text-secondary); padding:20px;">No recent articles found</div>';
            } else {
                articlesContainer.innerHTML = articles.map(article => `
                    <div class="article-item">
                        <div class="article-title">${article.title || 'Untitled'}</div>
                        <div class="article-meta">
                            ${article.keyword || ''} ‚Ä¢ ${article.published ? new Date(article.published).toLocaleDateString() : 'Recent'}
                        </div>
                        ${article.url ? `<a href="${article.url}" target="_blank" class="article-link">Read article ‚Üí</a>` : ''}
                    </div>
                `).join('');
            }
        }

        // Translation system
        const translations = {
            en: {
                pageTitle: "üá±üáß LEBANON STABILITY INDEX",
                pageSubtitle: "Multi-Factor Analysis: Political, Economic, Security & Hezbollah Status",
                lastUpdated: "Last updated: ",
                backLink: "‚Üê Back to Dashboard",
                themeToggle: "Theme",
                stabilityTitle: "LEBANON STABILITY INDEX",
                stabilityLegend: "100 = Stable Regime | 0 = Imminent Collapse",
                govStatus: "GOVERNMENT STATUS",
                president: "President: Joseph Aoun",
                daysInOffice: "Days in Office:",
                elected: "Elected:",
                daysUntilElections: "Days Until Elections:",
                currency: "CURRENCY (LBP/USD)",
                bondYield: "10Y EUROBOND YIELD",
                bondSubtitle: "Sovereign default risk",
                hezbollahActivity: "HEZBOLLAH ACTIVITY",
                last30Days: "Last 30 days",
                rearmamentReports: "Rearmament Reports",
                strikeMentions: "Strike Mentions",
                recentArticles: "üì∞ Recent Hezbollah & Security Articles (Last 30 Days)",
                knowledgeLibraryTitle: "Knowledge Library",
                catSecurity: "Security & Hezbollah Dynamics",
                catEconomic: "Economic & Financial Collapse",
                catGovernance: "Governance & Political Stability",
                catRegional: "Regional & External Influence",
                catStructural: "Structural Risk Indicators",
                rhetoricTracker: "RHETORIC TRACKER",
                rhetoricSubtitle: "Theatre escalation level",
                actorStatus: "ACTOR STATUS",
                activeAlerts: "ACTIVE ALERTS",
                voicesDetected: "VOICES DETECTED",
                viewFullAnalysis: "View Full Rhetoric Analysis ‚Üí"
            },
            he: {
                pageTitle: "üá±üáß ◊û◊ì◊ì ◊ô◊¶◊ô◊ë◊ï◊™ ◊ú◊ë◊†◊ï◊ü",
                pageSubtitle: "◊†◊ô◊™◊ï◊ó ◊®◊ë-◊í◊ï◊®◊û◊ô: ◊û◊¶◊ë ◊§◊ï◊ú◊ô◊ò◊ô, ◊õ◊ú◊õ◊ú◊ô, ◊ë◊ô◊ò◊ó◊ï◊†◊ô ◊ï◊ó◊ô◊ñ◊ë◊ê◊ú◊ú◊î",
                lastUpdated: "◊¢◊ï◊ì◊õ◊ü ◊ú◊ê◊ó◊®◊ï◊†◊î: ",
                backLink: "‚Üí ◊ó◊ñ◊®◊î ◊ú◊û◊®◊õ◊ñ ◊î◊ë◊ß◊®◊î",
                themeToggle: "◊¢◊®◊õ◊™ ◊†◊ï◊©◊ê",
                stabilityTitle: "◊û◊ì◊ì ◊ô◊¶◊ô◊ë◊ï◊™ ◊ú◊ë◊†◊ï◊ü",
                stabilityLegend: "100 = ◊û◊©◊ò◊® ◊ô◊¶◊ô◊ë | 0 = ◊ß◊®◊ô◊°◊î ◊ß◊®◊ï◊ë◊î",
                govStatus: "◊°◊ò◊ò◊ï◊° ◊î◊û◊û◊©◊ú◊î",
                president: "◊†◊©◊ô◊ê: ◊í'◊ï◊ñ◊£ ◊¢◊ï◊ü",
                daysInOffice: "◊ô◊û◊ô◊ù ◊ë◊™◊§◊ß◊ô◊ì:",
                elected: "◊†◊ë◊ó◊®:",
                daysUntilElections: "◊ô◊û◊ô◊ù ◊¢◊ì ◊î◊ë◊ó◊ô◊®◊ï◊™:",
                currency: "◊û◊ò◊ë◊¢ (◊ú◊ô◊®◊î ◊ú◊ë◊†◊ï◊†◊ô◊™/◊ì◊ï◊ú◊®)",
                bondYield: "◊™◊©◊ï◊ê◊™ ◊ê◊ô◊í◊®◊ï◊™ ◊ó◊ï◊ë 10 ◊©◊†◊ô◊ù",
                bondSubtitle: "◊°◊ô◊õ◊ï◊ü ◊ú◊û◊ó◊ì◊ú ◊®◊ô◊ë◊ï◊†◊ô",
                hezbollahActivity: "◊§◊¢◊ô◊ú◊ï◊™ ◊ó◊ô◊ñ◊ë◊ê◊ú◊ú◊î",
                last30Days: "30 ◊ô◊û◊ô◊ù ◊ê◊ó◊®◊ï◊†◊ô◊ù",
                rearmamentReports: "◊ì◊ô◊ï◊ï◊ó◊ô ◊ó◊ô◊û◊ï◊© ◊û◊ó◊ì◊©",
                strikeMentions: "◊ê◊ñ◊õ◊ï◊®◊ô ◊™◊ß◊ô◊§◊ï◊™",
                recentArticles: "üì∞ ◊õ◊™◊ë◊ï◊™ ◊ê◊ó◊®◊ï◊†◊ï◊™ ◊¢◊ú ◊ó◊ô◊ñ◊ë◊ê◊ú◊ú◊î ◊ï◊ë◊ô◊ò◊ó◊ï◊ü (30 ◊ô◊û◊ô◊ù)",
                knowledgeLibraryTitle: "◊°◊§◊®◊ô◊ô◊™ ◊ô◊ì◊¢",
                catSecurity: "◊ë◊ô◊ò◊ó◊ï◊ü ◊ï◊ì◊ô◊†◊û◊ô◊ß◊™ ◊ó◊ô◊ñ◊ë◊ê◊ú◊ú◊î",
                catEconomic: "◊ß◊®◊ô◊°◊î ◊õ◊ú◊õ◊ú◊ô◊™ ◊ï◊§◊ô◊†◊†◊°◊ô◊™",
                catGovernance: "◊û◊û◊©◊ú ◊ï◊ô◊¶◊ô◊ë◊ï◊™ ◊§◊ï◊ú◊ô◊ò◊ô◊™",
                catRegional: "◊î◊©◊§◊¢◊î ◊ê◊ñ◊ï◊®◊ô◊™ ◊ï◊ó◊ô◊¶◊ï◊†◊ô◊™",
                catStructural: "◊û◊ì◊ì◊ô ◊°◊ô◊õ◊ï◊ü ◊û◊ë◊†◊ô◊ô◊ù",
                rhetoricTracker: "◊û◊¢◊ß◊ë ◊®◊ò◊ï◊®◊ô◊ß◊î",
                rhetoricSubtitle: "◊®◊û◊™ ◊î◊°◊ú◊û◊î ◊ë◊ñ◊ô◊®◊î",
                actorStatus: "◊°◊ò◊ò◊ï◊° ◊©◊ó◊ß◊†◊ô◊ù",
                activeAlerts: "◊î◊™◊®◊ê◊ï◊™ ◊§◊¢◊ô◊ú◊ï◊™",
                voicesDetected: "◊ß◊ï◊ú◊ï◊™ ◊©◊ñ◊ï◊î◊ï",
                viewFullAnalysis: "‚Üí ◊†◊ô◊™◊ï◊ó ◊®◊ò◊ï◊®◊ô◊ß◊î ◊û◊ú◊ê"
            },
            ar: {
                pageTitle: "üá±üáß ŸÖÿ§ÿ¥ÿ± ÿßÿ≥ÿ™ŸÇÿ±ÿßÿ± ŸÑÿ®ŸÜÿßŸÜ",
                pageSubtitle: "ÿ™ÿ≠ŸÑŸäŸÑ ŸÖÿ™ÿπÿØÿØ ÿßŸÑÿπŸàÿßŸÖŸÑ: ÿßŸÑŸàÿ∂ÿπ ÿßŸÑÿ≥Ÿäÿßÿ≥Ÿä ŸàÿßŸÑÿßŸÇÿ™ÿµÿßÿØŸä ŸàÿßŸÑÿ£ŸÖŸÜŸä Ÿàÿ≠ÿ≤ÿ® ÿßŸÑŸÑŸá",
                lastUpdated: "ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´: ",
                backLink: "‚Üí ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ™ÿ≠ŸÉŸÖ",
                themeToggle: "ÿßŸÑÿ≥ŸÖÿ©",
                stabilityTitle: "ŸÖÿ§ÿ¥ÿ± ÿßÿ≥ÿ™ŸÇÿ±ÿßÿ± ŸÑÿ®ŸÜÿßŸÜ",
                stabilityLegend: "100 = ŸÜÿ∏ÿßŸÖ ŸÖÿ≥ÿ™ŸÇÿ± | 0 = ÿßŸÜŸáŸäÿßÿ± Ÿàÿ¥ŸäŸÉ",
                govStatus: "ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ŸÉŸàŸÖÿ©",
                president: "ÿßŸÑÿ±ÿ¶Ÿäÿ≥: ÿ¨Ÿàÿ≤ŸäŸÅ ÿπŸàŸÜ",
                daysInOffice: "ÿ£ŸäÿßŸÖ ŸÅŸä ÿßŸÑŸÖŸÜÿµÿ®:",
                elected: "ÿßŸÜÿ™ÿÆÿ®:",
                daysUntilElections: "ÿ£ŸäÿßŸÖ ÿ≠ÿ™Ÿâ ÿßŸÑÿßŸÜÿ™ÿÆÿßÿ®ÿßÿ™:",
                currency: "ÿßŸÑÿπŸÖŸÑÿ© (ŸÑŸäÿ±ÿ© ŸÑÿ®ŸÜÿßŸÜŸäÿ©/ÿØŸàŸÑÿßÿ±)",
                bondYield: "ÿπÿßÿ¶ÿØ ÿßŸÑÿ≥ŸÜÿØÿßÿ™ 10 ÿ≥ŸÜŸàÿßÿ™",
                bondSubtitle: "ŸÖÿÆÿßÿ∑ÿ± ÿßŸÑÿ™ÿÆŸÑŸÅ ÿπŸÜ ÿßŸÑÿ≥ÿØÿßÿØ ÿßŸÑÿ≥ŸäÿßÿØŸä",
                hezbollahActivity: "ŸÜÿ¥ÿßÿ∑ ÿ≠ÿ≤ÿ® ÿßŸÑŸÑŸá",
                last30Days: "ÿ¢ÿÆÿ± 30 ŸäŸàŸÖŸãÿß",
                rearmamentReports: "ÿ™ŸÇÿßÿ±Ÿäÿ± ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ™ÿ≥ŸÑÿ≠",
                strikeMentions: "ÿ•ÿ¥ÿßÿ±ÿßÿ™ ÿßŸÑÿ∂ÿ±ÿ®ÿßÿ™",
                recentArticles: "üì∞ ŸÖŸÇÿßŸÑÿßÿ™ ÿ≠ÿØŸäÿ´ÿ© ÿπŸÜ ÿ≠ÿ≤ÿ® ÿßŸÑŸÑŸá ŸàÿßŸÑÿ£ŸÖŸÜ (30 ŸäŸàŸÖŸãÿß)",
                knowledgeLibraryTitle: "ŸÖŸÉÿ™ÿ®ÿ© ÿßŸÑŸÖÿπÿ±ŸÅÿ©",
                catSecurity: "ÿßŸÑÿ£ŸÖŸÜ ŸàÿØŸäŸÜÿßŸÖŸäŸÉŸäÿßÿ™ ÿ≠ÿ≤ÿ® ÿßŸÑŸÑŸá",
                catEconomic: "ÿßŸÑÿßŸÜŸáŸäÿßÿ± ÿßŸÑÿßŸÇÿ™ÿµÿßÿØŸä ŸàÿßŸÑŸÖÿßŸÑŸä",
                catGovernance: "ÿßŸÑÿ≠ŸàŸÉŸÖÿ© ŸàÿßŸÑÿßÿ≥ÿ™ŸÇÿ±ÿßÿ± ÿßŸÑÿ≥Ÿäÿßÿ≥Ÿä",
                catRegional: "ÿßŸÑŸÜŸÅŸàÿ∞ ÿßŸÑÿ•ŸÇŸÑŸäŸÖŸä ŸàÿßŸÑÿÆÿßÿ±ÿ¨Ÿä",
                catStructural: "ŸÖÿ§ÿ¥ÿ±ÿßÿ™ ÿßŸÑŸÖÿÆÿßÿ∑ÿ± ÿßŸÑŸáŸäŸÉŸÑŸäÿ©",
                rhetoricTracker: "ŸÖÿ™ÿ™ÿ®ÿπ ÿßŸÑÿÆÿ∑ÿßÿ®",
                rhetoricSubtitle: "ŸÖÿ≥ÿ™ŸàŸâ ÿßŸÑÿ™ÿµÿπŸäÿØ ŸÅŸä ÿßŸÑŸÖÿ≥ÿ±ÿ≠",
                actorStatus: "ÿ≠ÿßŸÑÿ© ÿßŸÑÿ¨Ÿáÿßÿ™ ÿßŸÑŸÅÿßÿπŸÑÿ©",
                activeAlerts: "ÿßŸÑÿ™ŸÜÿ®ŸäŸáÿßÿ™ ÿßŸÑŸÜÿ¥ÿ∑ÿ©",
                voicesDetected: "ÿßŸÑÿ£ÿµŸàÿßÿ™ ÿßŸÑŸÖŸÉÿ™ÿ¥ŸÅÿ©",
                viewFullAnalysis: "‚Üê ÿπÿ±ÿ∂ ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑ ÿßŸÑŸÉÿßŸÖŸÑ ŸÑŸÑÿÆÿ∑ÿßÿ®"
            },
            fa: {
                pageTitle: "üá±üáß ÿ¥ÿßÿÆÿµ ÿ´ÿ®ÿßÿ™ ŸÑÿ®ŸÜÿßŸÜ",
                pageSubtitle: "ÿ™ÿ≠ŸÑ€åŸÑ ⁄ÜŸÜÿØÿπÿßŸÖŸÑ€å: Ÿàÿ∂ÿπ€åÿ™ ÿ≥€åÿßÿ≥€åÿå ÿßŸÇÿ™ÿµÿßÿØ€åÿå ÿßŸÖŸÜ€åÿ™€å Ÿà ÿ≠ÿ≤ÿ®‚ÄåÿßŸÑŸÑŸá",
                lastUpdated: "ÿ¢ÿÆÿ±€åŸÜ ÿ®Ÿá‚Äåÿ±Ÿàÿ≤ÿ±ÿ≥ÿßŸÜ€å: ",
                backLink: "‚Üí ÿ®ÿßÿ≤⁄Øÿ¥ÿ™ ÿ®Ÿá ÿØÿßÿ¥ÿ®Ÿàÿ±ÿØ",
                themeToggle: "ŸæŸàÿ≥ÿ™Ÿá",
                stabilityTitle: "ÿ¥ÿßÿÆÿµ ÿ´ÿ®ÿßÿ™ ŸÑÿ®ŸÜÿßŸÜ",
                stabilityLegend: "100 = ÿ±⁄ò€åŸÖ Ÿæÿß€åÿØÿßÿ± | 0 = ŸÅÿ±ŸàŸæÿßÿ¥€å ŸÇÿ±€åÿ®‚ÄåÿßŸÑŸàŸÇŸàÿπ",
                govStatus: "Ÿàÿ∂ÿπ€åÿ™ ÿØŸàŸÑÿ™",
                president: "ÿ±ÿ¶€åÿ≥‚Äåÿ¨ŸÖŸáŸàÿ±: ⁄òŸàÿ≤ŸÅ ÿπŸàŸÜ",
                daysInOffice: "ÿ±Ÿàÿ≤Ÿáÿß€å ÿØÿ± ŸÖŸÇÿßŸÖ:",
                elected: "ÿßŸÜÿ™ÿÆÿßÿ® ÿ¥ÿØŸá:",
                daysUntilElections: "ÿ±Ÿàÿ≤Ÿáÿß ÿ™ÿß ÿßŸÜÿ™ÿÆÿßÿ®ÿßÿ™:",
                currency: "ÿßÿ±ÿ≤ (ŸÑ€åÿ±Ÿá ŸÑÿ®ŸÜÿßŸÜ/ÿØŸÑÿßÿ±)",
                bondYield: "ÿ®ÿßÿ≤ÿØŸá ÿßŸàÿ±ÿßŸÇ ŸÇÿ±ÿ∂Ÿá 10 ÿ≥ÿßŸÑŸá",
                bondSubtitle: "ÿ±€åÿ≥⁄© ŸÜ⁄©ŸàŸÑ ÿ≠ÿß⁄©ŸÖ€åÿ™€å",
                hezbollahActivity: "ŸÅÿπÿßŸÑ€åÿ™ ÿ≠ÿ≤ÿ®‚ÄåÿßŸÑŸÑŸá",
                last30Days: "30 ÿ±Ÿàÿ≤ ⁄Øÿ∞ÿ¥ÿ™Ÿá",
                rearmamentReports: "⁄Øÿ≤ÿßÿ±ÿ¥‚ÄåŸáÿß€å ÿ™ÿ≥ŸÑ€åÿ≠ ŸÖÿ¨ÿØÿØ",
                strikeMentions: "ÿßÿ¥ÿßÿ±Ÿá ÿ®Ÿá ÿ≠ŸÖŸÑÿßÿ™",
                recentArticles: "üì∞ ŸÖŸÇÿßŸÑÿßÿ™ ÿßÿÆ€åÿ± ÿØÿ±ÿ®ÿßÿ±Ÿá ÿ≠ÿ≤ÿ®‚ÄåÿßŸÑŸÑŸá Ÿà ÿßŸÖŸÜ€åÿ™ (30 ÿ±Ÿàÿ≤)",
                knowledgeLibraryTitle: "⁄©ÿ™ÿßÿ®ÿÆÿßŸÜŸá ÿØÿßŸÜÿ¥",
                catSecurity: "ÿßŸÖŸÜ€åÿ™ Ÿà ŸæŸà€åÿß€å€å‚ÄåŸáÿß€å ÿ≠ÿ≤ÿ®‚ÄåÿßŸÑŸÑŸá",
                catEconomic: "ŸÅÿ±ŸàŸæÿßÿ¥€å ÿßŸÇÿ™ÿµÿßÿØ€å Ÿà ŸÖÿßŸÑ€å",
                catGovernance: "ÿ≠⁄©ŸàŸÖÿ™ Ÿà ÿ´ÿ®ÿßÿ™ ÿ≥€åÿßÿ≥€å",
                catRegional: "ŸÜŸÅŸàÿ∞ ŸÖŸÜÿ∑ŸÇŸá‚Äåÿß€å Ÿà ÿÆÿßÿ±ÿ¨€å",
                catStructural: "ÿ¥ÿßÿÆÿµ‚ÄåŸáÿß€å ÿ±€åÿ≥⁄© ÿ≥ÿßÿÆÿ™ÿßÿ±€å",
                rhetoricTracker: "ÿ±ÿØ€åÿßÿ® ⁄ØŸÅÿ™ŸÖÿßŸÜ",
                rhetoricSubtitle: "ÿ≥ÿ∑ÿ≠ ÿ™ÿ¥ÿØ€åÿØ ÿØÿ± ÿµÿ≠ŸÜŸá",
                actorStatus: "Ÿàÿ∂ÿπ€åÿ™ ÿ®ÿßÿ≤€å⁄Øÿ±ÿßŸÜ",
                activeAlerts: "Ÿáÿ¥ÿØÿßÿ±Ÿáÿß€å ŸÅÿπÿßŸÑ",
                voicesDetected: "ÿµÿØÿßŸáÿß€å ÿ¥ŸÜÿßÿ≥ÿß€å€å‚Äåÿ¥ÿØŸá",
                viewFullAnalysis: "‚Üê ŸÖÿ¥ÿßŸáÿØŸá ÿ™ÿ≠ŸÑ€åŸÑ ⁄©ÿßŸÖŸÑ ⁄ØŸÅÿ™ŸÖÿßŸÜ"
            }
        };

        function switchLanguage(lang, button) {
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');

            if (lang === 'he' || lang === 'ar' || lang === 'fa') {
                document.documentElement.setAttribute('dir', 'rtl');
            } else {
                document.documentElement.setAttribute('dir', 'ltr');
            }

            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (translations[lang] && translations[lang][key]) {
                    if (key === 'lastUpdated' && element.id === 'lastUpdated') {
                        const currentText = element.textContent;
                        if (currentText.includes(':')) {
                            const timestamp = currentText.split(': ')[1];
                            element.textContent = translations[lang][key] + timestamp;
                        } else {
                            element.textContent = translations[lang][key] + 'Loading...';
                        }
                    } else {
                        element.textContent = translations[lang][key];
                    }
                }
            });
        }

        // Knowledge Library Toggle
        function toggleKnowledgeCard(cardId) {
            const card = document.getElementById(`card-${cardId}`);
            if (card) {
                card.classList.toggle('collapsed');
            }
        }

        // Election News Scanner (Google News RSS, client-side)
        async function loadElectionNews() {
            try {
                const query = encodeURIComponent('Lebanon 2026 parliamentary elections');
                const url = `https://news.google.com/rss/search?q=${query}&hl=en-US&gl=US&ceid=US:en`;
                const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`;
                
                const response = await fetch(proxyUrl);
                const text = await response.text();
                const parser = new DOMParser();
                const xml = parser.parseFromString(text, 'text/xml');
                const items = xml.querySelectorAll('item');
                
                const container = document.getElementById('electionNewsContainer');
                if (items.length === 0) {
                    container.innerHTML = '<span style="color: var(--text-secondary);">No recent election articles</span>';
                    return;
                }
                
                const articles = Array.from(items).slice(0, 3);
                container.innerHTML = articles.map(item => {
                    const title = item.querySelector('title')?.textContent || 'Untitled';
                    const link = item.querySelector('link')?.textContent || '#';
                    const pubDate = item.querySelector('pubDate')?.textContent;
                    const dateStr = pubDate ? new Date(pubDate).toLocaleDateString() : '';
                    return `
                        <div style="margin-bottom: 8px;">
                            <a href="${link}" target="_blank" style="color: #6495ED; text-decoration: none; font-size: 11px; line-height: 1.4;">
                                ‚Üí ${title.length > 80 ? title.substring(0, 80) + '...' : title}
                            </a>
                            ${dateStr ? `<span style="color: var(--text-muted); font-size: 10px; margin-left: 4px;">${dateStr}</span>` : ''}
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error loading election news:', error);
                document.getElementById('electionNewsContainer').innerHTML = 
                    '<span style="color: var(--text-secondary); font-size: 11px;">Election news unavailable</span>';
            }
        }

        // Initialize Lebanon Map (Leaflet/OpenStreetMap)
        function initLebanonMap() {
            const map = L.map('lebanon-map', {
                center: [33.88, 35.50],
                zoom: 8,
                scrollWheelZoom: false
            });
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
                maxZoom: 18
            }).addTo(map);
            
            const markers = [
                { lat: 33.8938, lng: 35.5018, name: 'Beirut', desc: 'Capital' },
                { lat: 33.8547, lng: 35.8623, name: 'Baalbek', desc: 'Bekaa Valley' },
                { lat: 33.2705, lng: 35.2038, name: 'Tyre (Sour)', desc: 'South Lebanon' },
                { lat: 34.4367, lng: 35.8497, name: 'Tripoli', desc: 'North Lebanon' },
                { lat: 33.3789, lng: 35.4840, name: 'Sidon (Saida)', desc: 'South Lebanon' },
                { lat: 33.8114, lng: 35.4882, name: 'BEY Airport', desc: 'Rafic Hariri Intl' }
            ];
            
            markers.forEach(m => {
                L.marker([m.lat, m.lng])
                    .addTo(map)
                    .bindPopup(`<strong>${m.name}</strong><br>${m.desc}`);
            });
        }

        // Rhetoric Tracker Integration
        async function loadRhetoricData() {
            try {
                const response = await fetch(`${LEBANON_BACKEND_URL}/api/rhetoric/lebanon/summary`);
                const data = await response.json();
                
                if (data.awaiting_scan) {
                    document.getElementById('rhetoricScore').textContent = '...';
                    document.getElementById('rhetoricScanInfo').textContent = 'Initial scan in progress';
                    return;
                }
                
                // Score and theatre label
                document.getElementById('rhetoricScore').textContent = `${data.rhetoric_score}/100`;
                
                const label = document.getElementById('rhetoricTheatreLabel');
                label.textContent = data.theatre_label || '--';
                label.style.background = data.theatre_color || '#6b7280';
                
                // Scan time
                if (data.scanned_at) {
                    const scanDate = new Date(data.scanned_at);
                    const ago = Math.round((Date.now() - scanDate.getTime()) / 60000);
                    const agoText = ago < 60 ? `${ago}m ago` : `${Math.round(ago/60)}h ago`;
                    document.getElementById('rhetoricScanInfo').textContent = `Last scan: ${agoText}`;
                }
                
                // Now fetch full data for actor breakdown
                const fullResponse = await fetch(`${LEBANON_BACKEND_URL}/api/rhetoric/lebanon`);
                const fullData = await fullResponse.json();
                
                if (fullData.actors) {
                    const actorList = document.getElementById('rhetoricActorList');
                    actorList.innerHTML = '';
                    
                    const actorOrder = ['hezbollah_political', 'hezbollah_military', 'iran_lebanon', 'israel_lebanon', 'lebanese_government', 'unifil'];
                    
                    actorOrder.forEach(actorId => {
                        const actor = fullData.actors[actorId];
                        if (!actor) return;
                        
                        const silenceIcon = actor.silence_alert ? ' üîá' : '';
                        const countText = actor.statement_count > 0 ? `${actor.statement_count} articles` : 'No articles';
                        
                        actorList.innerHTML += `
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 4px 0; border-bottom: 1px solid var(--card-border);">
                                <span>${actor.flag} ${actor.icon} ${actor.name}${silenceIcon}</span>
                                <span style="display: flex; align-items: center; gap: 6px;">
                                    <span style="font-size: 10px; color: var(--text-muted);">${countText}</span>
                                    <span style="display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: ${actor.escalation_color};"></span>
                                    <span style="font-size: 10px; font-weight: 600; color: ${actor.escalation_color};">${actor.escalation_label}</span>
                                </span>
                            </div>
                        `;
                    });
                }
                
                // Alerts
                if (fullData.alerts && fullData.alerts.length > 0) {
                    const alertsContainer = document.getElementById('rhetoricAlerts');
                    const alertList = document.getElementById('rhetoricAlertList');
                    alertsContainer.style.display = 'block';
                    
                    alertList.innerHTML = fullData.alerts.slice(0, 3).map(alert => {
                        const bgColor = alert.severity === 'critical' ? 'rgba(248,113,113,0.15)' :
                                        alert.severity === 'high' ? 'rgba(251,146,60,0.15)' :
                                        'rgba(250,204,21,0.1)';
                        const borderColor = alert.severity === 'critical' ? '#f87171' :
                                           alert.severity === 'high' ? '#fb923c' : '#facc15';
                        return `
                            <div style="padding: 6px 8px; margin-bottom: 4px; background: ${bgColor}; border-left: 3px solid ${borderColor}; border-radius: 4px; font-size: 11px; color: var(--text-primary);">
                                ${alert.message}
                            </div>
                        `;
                    }).join('');
                }
                
                // Spokespersons
                const allSpokes = [];
                if (fullData.actors) {
                    Object.values(fullData.actors).forEach(actor => {
                        if (actor.spokespersons && actor.spokespersons.length > 0) {
                            actor.spokespersons.forEach(s => {
                                allSpokes.push(`${actor.icon} ${s}`);
                            });
                        }
                    });
                }
                
                if (allSpokes.length > 0) {
                    document.getElementById('rhetoricSpokespeople').style.display = 'block';
                    document.getElementById('rhetoricSpokesList').textContent = allSpokes.slice(0, 6).join(' ‚Ä¢ ');
                }
                
            } catch (error) {
                console.error('Error loading rhetoric data:', error);
                document.getElementById('rhetoricScore').textContent = 'N/A';
                document.getElementById('rhetoricScanInfo').textContent = 'Data unavailable';
            }
        }

        // Load data on page load
        document.addEventListener('DOMContentLoaded', () => {
            startLoadingProgress();
            loadLebanonData();
        });
    </script>
</body>
</html>
