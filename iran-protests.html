<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iran Protests Monitor - Asifah Analytics</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            color: #e2e8f0;
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1rem;
            background: rgba(30, 41, 59, 0.6);
            border-radius: 12px;
        }

        .left-nav {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .back-button {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background: #334155;
            color: #e2e8f0;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: #475569;
            transform: translateY(-2px);
        }

        .analytics-widget {
            display: inline-block;
        }

        .analytics-button {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .analytics-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .storm-icon {
            font-size: 1.2rem;
        }

        .language-switcher {
            display: flex;
            gap: 0.5rem;
            background: rgba(51, 65, 85, 0.5);
            padding: 0.5rem;
            border-radius: 8px;
        }

        .lang-btn {
            background: transparent;
            border: 1px solid #475569;
            color: #94a3b8;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .lang-btn:hover {
            background: rgba(71, 85, 105, 0.5);
            color: #e2e8f0;
        }

        .lang-btn.active {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }

        .header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 2px solid #334155;
        }

        .header h1 {
            font-size: 2.5rem;
            color: #f1f5f9;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }

        .header .flag {
            font-size: 3rem;
        }

        .subtitle {
            color: #94a3b8;
            font-size: 1.1rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stats-card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-5px);
            border-color: #475569;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .stats-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .stats-number {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stats-card:nth-child(1) .stats-number {
            color: #ef4444;
        }

        .stats-card:nth-child(2) .stats-number {
            color: #3b82f6;
        }

        .stats-card:nth-child(3) .stats-number {
            color: #8b5cf6;
        }

        .stats-card:nth-child(4) .stats-number {
            color: #f59e0b;
        }

        .stats-label {
            color: #94a3b8;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stats-title {
            color: #94a3b8;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }

        .verified-badge {
            display: inline-block;
            background: #10b981;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: bold;
            margin-top: 0.5rem;
        }

        .city-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .city-tag {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #fca5a5;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .news-section {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .news-section h2 {
            color: #f1f5f9;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
        }

        .news-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            border-bottom: 2px solid #334155;
            padding-bottom: 1rem;
        }

        .news-tab {
            background: transparent;
            border: none;
            color: #94a3b8;
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .news-tab:hover {
            background: rgba(51, 65, 85, 0.5);
            color: #e2e8f0;
        }

        .news-tab.active {
            background: #3b82f6;
            color: white;
        }

        .articles-container {
            display: grid;
            gap: 1rem;
            max-height: 600px;
            overflow-y: auto;
            padding-right: 1rem;
        }

        .articles-container::-webkit-scrollbar {
            width: 8px;
        }

        .articles-container::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 4px;
        }

        .articles-container::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }

        .article-card {
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .article-card:hover {
            border-color: #3b82f6;
            transform: translateX(5px);
        }

        .article-title {
            color: #f1f5f9;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .article-source {
            color: #3b82f6;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .article-description {
            color: #94a3b8;
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .article-link {
            color: #60a5fa;
            text-decoration: none;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .article-link:hover {
            color: #93c5fd;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: #94a3b8;
        }

        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            color: #fca5a5;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .no-articles {
            text-align: center;
            color: #94a3b8;
            padding: 2rem;
            font-style: italic;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .header h1 {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .news-tabs {
                flex-direction: column;
            }

            .news-tab {
                width: 100%;
            }

            .top-bar {
                flex-direction: column;
                gap: 1rem;
            }

            .language-switcher {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-bar">
            <div class="left-nav">
                <a href="index.html" class="back-button" data-translate="back">‚Üê Back to Dashboard</a>
                <div class="analytics-widget">
                    <a href="https://analytics.google.com/analytics/web/#/a381040543p520399776/reports/intelligenthome" target="_blank" class="analytics-button">
                        <span class="storm-icon">‚õàÔ∏è</span>
                        <span data-translate="analytics">Analytics</span>
                    </a>
                </div>
            </div>
            <div class="language-switcher">
                <button class="lang-btn active" data-lang="en">EN</button>
                <button class="lang-btn" data-lang="he">◊¢◊ë</button>
                <button class="lang-btn" data-lang="ar">ÿπ</button>
                <button class="lang-btn" data-lang="fa">ŸÅÿßÿ±ÿ≥€å</button>
            </div>
        </div>

        <div class="header">
            <h1>
                <span class="flag">üáÆüá∑</span>
                <span data-translate="title">Iran Protests Monitor</span>
            </h1>
            <p class="subtitle" data-translate="subtitle">Real-time tracking of protests, casualties, and geographic spread</p>
        </div>

        <div class="stats-grid">
            <div class="stats-card">
                <div class="stats-icon">‚ò†Ô∏è</div>
                <h3 class="stats-title" data-translate="deaths-title">DEATHS REPORTED</h3>
                <div class="stats-number" id="deaths-count">--</div>
                <div class="stats-label" data-translate="deaths-label">Confirmed fatalities</div>
                <span class="verified-badge" data-translate="verified">VERIFIED</span>
            </div>

            <div class="stats-card">
                <div class="stats-icon">ü©π</div>
                <h3 class="stats-title" data-translate="injuries-title">INJURIES REPORTED</h3>
                <div class="stats-number" id="injuries-count">--</div>
                <div class="stats-label" data-translate="injuries-label">Seriously injured</div>
                <span class="verified-badge" data-translate="verified">VERIFIED</span>
            </div>

            <div class="stats-card">
                <div class="stats-icon">‚õìÔ∏è</div>
                <h3 class="stats-title" data-translate="arrests-title">ARRESTS REPORTED</h3>
                <div class="stats-number" id="arrests-count">--</div>
                <div class="stats-label" data-translate="arrests-label">Total detentions</div>
                <span class="verified-badge" data-translate="verified">VERIFIED</span>
            </div>

            <div class="stats-card">
                <h3 class="stats-title" data-translate="geographic-title">GEOGRAPHIC SPREAD</h3>
                <div class="stats-number" id="cities-affected">--</div>
                <div class="stats-label" data-translate="cities-label">Cities affected</div>
                <div style="font-size: 0.9em; color: #94a3b8; margin-top: 0.5rem;" id="provinces-affected">
                    <span data-translate="provinces-label">-- provinces affected</span>
                </div>
                <div class="city-tags" id="city-tags-container">
                    <!-- Cities will be loaded dynamically -->
                </div>
            </div>
        </div>

        <div class="news-section">
            <h2><span data-translate="news-title">üì∞ News Coverage</span></h2>
            <div class="news-tabs">
                <button class="news-tab active" data-source="hrana">HRANA (<span id="hrana-count">0</span>)</button>
                <button class="news-tab" data-source="iranwire">Iran Wire (<span id="iranwire-count">0</span>)</button>
                <button class="news-tab" data-source="farsi">Farsi (<span id="farsi-count">0</span>)</button>
                <button class="news-tab" data-source="english">English (<span id="english-count">0</span>)</button>
                <button class="news-tab" data-source="hebrew">Hebrew (<span id="hebrew-count">0</span>)</button>
                <button class="news-tab" data-source="arabic">Arabic (<span id="arabic-count">0</span>)</button>
                <button class="news-tab" data-source="reddit">Reddit (<span id="reddit-count">0</span>)</button>
            </div>
            <div class="articles-container" id="articles-container">
                <div class="loading" data-translate="loading">Loading articles...</div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://asifah-backend.onrender.com';
        let allArticlesData = {};
        let currentSource = 'hrana';
        let currentLang = 'en';

        // Translation dictionary
        const translations = {
            en: {
                'back': '‚Üê Back to Dashboard',
                'analytics': 'Analytics',
                'title': 'Iran Protests Monitor',
                'subtitle': 'Real-time tracking of protests, casualties, and geographic spread',
                'deaths-title': 'DEATHS REPORTED',
                'deaths-label': 'Confirmed fatalities',
                'injuries-title': 'INJURIES REPORTED',
                'injuries-label': 'Seriously injured',
                'arrests-title': 'ARRESTS REPORTED',
                'arrests-label': 'Total detentions',
                'geographic-title': 'GEOGRAPHIC SPREAD',
                'cities-label': 'Cities affected',
                'provinces-label': 'provinces affected',
                'verified': 'VERIFIED',
                'news-title': 'üì∞ News Coverage',
                'loading': 'Loading articles...'
            },
            he: {
                'back': '‚Üí ◊ó◊ñ◊®◊î ◊ú◊ú◊ï◊ó ◊î◊û◊ó◊ï◊ï◊†◊ô◊ù',
                'analytics': '◊ê◊†◊ú◊ô◊ò◊ô◊ß◊î',
                'title': '◊û◊¢◊ß◊ë ◊î◊§◊í◊†◊ï◊™ ◊ê◊ô◊®◊ê◊ü',
                'subtitle': '◊û◊¢◊ß◊ë ◊ë◊ñ◊û◊ü ◊ê◊û◊™ ◊ê◊ó◊® ◊î◊§◊í◊†◊ï◊™, ◊†◊§◊í◊¢◊ô◊ù ◊ï◊î◊™◊§◊©◊ò◊ï◊™ ◊í◊ô◊ê◊ï◊í◊®◊§◊ô◊™',
                'deaths-title': '◊û◊ß◊®◊ô ◊û◊ï◊ï◊™ ◊û◊ì◊ï◊ï◊ó◊ô◊ù',
                'deaths-label': '◊î◊®◊ï◊í◊ô◊ù ◊û◊ê◊ï◊©◊®◊ô◊ù',
                'injuries-title': '◊§◊í◊ô◊¢◊ï◊™ ◊û◊ì◊ï◊ï◊ó◊ï◊™',
                'injuries-label': '◊§◊¶◊ï◊¢◊ô◊ù ◊ß◊©◊î',
                'arrests-title': '◊û◊¢◊¶◊®◊ô◊ù ◊û◊ì◊ï◊ï◊ó◊ô◊ù',
                'arrests-label': '◊°◊ö ◊õ◊ú ◊¢◊ô◊õ◊ï◊ë◊ô◊ù',
                'geographic-title': '◊î◊™◊§◊©◊ò◊ï◊™ ◊í◊ô◊ê◊ï◊í◊®◊§◊ô◊™',
                'cities-label': '◊¢◊®◊ô◊ù ◊û◊ï◊©◊§◊¢◊ï◊™',
                'provinces-label': '◊û◊ó◊ï◊ñ◊ï◊™ ◊û◊ï◊©◊§◊¢◊ô◊ù',
                'verified': '◊û◊ê◊ï◊û◊™',
                'news-title': 'üì∞ ◊°◊ô◊ß◊ï◊® ◊ó◊ì◊©◊ï◊™',
                'loading': '◊ò◊ï◊¢◊ü ◊û◊ê◊û◊®◊ô◊ù...'
            },
            ar: {
                'back': '‚Üí ÿßŸÑÿπŸàÿØÿ© ÿ•ŸÑŸâ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÇŸäÿßÿØÿ©',
                'analytics': 'ÿßŸÑÿ™ÿ≠ŸÑŸäŸÑÿßÿ™',
                'title': 'ŸÖÿ±ÿßŸÇÿ®ÿ© ÿßÿ≠ÿ™ÿ¨ÿßÿ¨ÿßÿ™ ÿ•Ÿäÿ±ÿßŸÜ',
                'subtitle': 'ÿ™ÿ™ÿ®ÿπ ŸÅŸä ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÅÿπŸÑŸä ŸÑŸÑÿßÿ≠ÿ™ÿ¨ÿßÿ¨ÿßÿ™ ŸàÿßŸÑÿ•ÿµÿßÿ®ÿßÿ™ ŸàÿßŸÑÿßŸÜÿ™ÿ¥ÿßÿ± ÿßŸÑÿ¨ÿ∫ÿ±ÿßŸÅŸä',
                'deaths-title': 'ÿßŸÑŸàŸÅŸäÿßÿ™ ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿπŸÜŸáÿß',
                'deaths-label': 'ÿßŸÑŸàŸÅŸäÿßÿ™ ÿßŸÑŸÖÿ§ŸÉÿØÿ©',
                'injuries-title': 'ÿßŸÑÿ•ÿµÿßÿ®ÿßÿ™ ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿπŸÜŸáÿß',
                'injuries-label': 'ŸÖÿµÿßÿ®ŸàŸÜ ÿ®ÿ¨ÿ±Ÿàÿ≠ ÿÆÿ∑Ÿäÿ±ÿ©',
                'arrests-title': 'ÿßŸÑÿßÿπÿ™ŸÇÿßŸÑÿßÿ™ ÿßŸÑŸÖÿ®ŸÑÿ∫ ÿπŸÜŸáÿß',
                'arrests-label': 'ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿßÿ≠ÿ™ÿ¨ÿßÿ≤ÿßÿ™',
                'geographic-title': 'ÿßŸÑÿßŸÜÿ™ÿ¥ÿßÿ± ÿßŸÑÿ¨ÿ∫ÿ±ÿßŸÅŸä',
                'cities-label': 'ÿßŸÑŸÖÿØŸÜ ÿßŸÑŸÖÿ™ÿ£ÿ´ÿ±ÿ©',
                'provinces-label': 'ÿßŸÑŸÖÿ≠ÿßŸÅÿ∏ÿßÿ™ ÿßŸÑŸÖÿ™ÿ£ÿ´ÿ±ÿ©',
                'verified': 'ÿ™ŸÖ ÿßŸÑÿ™ÿ≠ŸÇŸÇ',
                'news-title': 'üì∞ ÿßŸÑÿ™ÿ∫ÿ∑Ÿäÿ© ÿßŸÑÿ•ÿÆÿ®ÿßÿ±Ÿäÿ©',
                'loading': 'ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÇÿßŸÑÿßÿ™...'
            },
            fa: {
                'back': '‚Üí ÿ®ÿßÿ≤⁄Øÿ¥ÿ™ ÿ®Ÿá ÿØÿßÿ¥ÿ®Ÿàÿ±ÿØ',
                'analytics': 'ÿ™ÿ≠ŸÑ€åŸÑ‚ÄåŸáÿß',
                'title': 'ŸÜÿ∏ÿßÿ±ÿ™ ÿ®ÿ± ÿßÿπÿ™ÿ±ÿßÿ∂ÿßÿ™ ÿß€åÿ±ÿßŸÜ',
                'subtitle': 'Ÿæ€å⁄Ø€åÿ±€å ŸÑÿ≠ÿ∏Ÿá‚Äåÿß€å ÿßÿπÿ™ÿ±ÿßÿ∂ÿßÿ™ÿå ÿ™ŸÑŸÅÿßÿ™ Ÿà ⁄Øÿ≥ÿ™ÿ±Ÿá ÿ¨ÿ∫ÿ±ÿßŸÅ€åÿß€å€å',
                'deaths-title': 'ŸÖÿ±⁄Ø‚ÄåŸáÿß€å ⁄Øÿ≤ÿßÿ±ÿ¥ ÿ¥ÿØŸá',
                'deaths-label': '⁄©ÿ¥ÿ™Ÿá‚ÄåŸáÿß€å ÿ™ÿ£€å€åÿØ ÿ¥ÿØŸá',
                'injuries-title': 'ŸÖÿ¨ÿ±Ÿàÿ≠ÿßŸÜ ⁄Øÿ≤ÿßÿ±ÿ¥ ÿ¥ÿØŸá',
                'injuries-label': 'ŸÖÿ¨ÿ±Ÿàÿ≠ÿßŸÜ ÿ¥ÿØ€åÿØ',
                'arrests-title': 'ÿ®ÿßÿ≤ÿØÿßÿ¥ÿ™‚ÄåŸáÿß€å ⁄Øÿ≤ÿßÿ±ÿ¥ ÿ¥ÿØŸá',
                'arrests-label': '⁄©ŸÑ ÿ®ÿßÿ≤ÿØÿßÿ¥ÿ™‚ÄåŸáÿß',
                'geographic-title': '⁄Øÿ≥ÿ™ÿ±Ÿá ÿ¨ÿ∫ÿ±ÿßŸÅ€åÿß€å€å',
                'cities-label': 'ÿ¥Ÿáÿ±Ÿáÿß€å ÿ™ÿ≠ÿ™ ÿ™ÿ£ÿ´€åÿ±',
                'provinces-label': 'ÿßÿ≥ÿ™ÿßŸÜ‚ÄåŸáÿß€å ÿ™ÿ≠ÿ™ ÿ™ÿ£ÿ´€åÿ±',
                'verified': 'ÿ™ÿ£€å€åÿØ ÿ¥ÿØŸá',
                'news-title': 'üì∞ ŸæŸàÿ¥ÿ¥ ÿÆÿ®ÿ±€å',
                'loading': 'ÿØÿ± ÿ≠ÿßŸÑ ÿ®ÿßÿ±⁄Øÿ∞ÿßÿ±€å ŸÖŸÇÿßŸÑÿßÿ™...'
            }
        };

        // Translation function
        function translatePage(lang) {
            currentLang = lang;
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translations[lang] && translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });

            // Update province text dynamically
            const provincesText = document.getElementById('provinces-affected');
            if (provincesText) {
                const count = provincesText.textContent.match(/\d+/)?.[0] || '--';
                provincesText.innerHTML = `<span data-translate="provinces-label">${count} ${translations[lang]['provinces-label']}</span>`;
            }

            // Update document direction for RTL languages
            if (lang === 'he' || lang === 'ar' || lang === 'fa') {
                document.body.style.direction = 'rtl';
            } else {
                document.body.style.direction = 'ltr';
            }
        }

        // Language switcher event listeners
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                translatePage(btn.getAttribute('data-lang'));
            });
        });

        // Load protest statistics and geographic data
        async function loadProtestData() {
            try {
                // Try the new endpoint first
                let response = await fetch(`${API_BASE_URL}/iran-protests-data`);
                
                // If 404, fallback to scan-iran-protests
                if (!response.ok) {
                    console.log('iran-protests-data not found, using scan-iran-protests');
                    response = await fetch(`${API_BASE_URL}/scan-iran-protests?days=7`);
                    
                    if (!response.ok) throw new Error('Failed to fetch data');
                    
                    const data = await response.json();
                    
                    // Use casualties from scan endpoint
                    document.getElementById('deaths-count').textContent = 
                        (data.casualties?.deaths || 0).toLocaleString();
                    document.getElementById('injuries-count').textContent = 
                        (data.casualties?.injuries || 0).toLocaleString();
                    document.getElementById('arrests-count').textContent = 
                        (data.casualties?.arrests || 0).toLocaleString();
                    
                    // Geographic data
                    document.getElementById('cities-affected').textContent = 
                        data.num_cities_affected || '--';
                    
                    // City tags from cities array
                    const cityTagsContainer = document.getElementById('city-tags-container');
                    cityTagsContainer.innerHTML = '';
                    
                    if (data.cities && data.cities.length > 0) {
                        data.cities.slice(0, 5).forEach(cityObj => {
                            const tag = document.createElement('span');
                            tag.className = 'city-tag';
                            tag.textContent = cityObj.name || cityObj;
                            cityTagsContainer.appendChild(tag);
                        });
                    }
                    
                    return;
                }
                
                // If iran-protests-data works, use it
                const data = await response.json();
                console.log('Iran protests data:', data);
                
                document.getElementById('deaths-count').textContent = 
                    data.casualties.deaths.toLocaleString();
                document.getElementById('injuries-count').textContent = 
                    data.casualties.injuries.toLocaleString();
                document.getElementById('arrests-count').textContent = 
                    data.casualties.arrests.toLocaleString();
                
                document.getElementById('cities-affected').textContent = 
                    data.geographic.cities_affected;
                document.getElementById('provinces-affected').textContent = 
                    `${data.geographic.provinces_affected} ${translations[currentLang]['provinces-label']}`;
                
                const cityTagsContainer = document.getElementById('city-tags-container');
                cityTagsContainer.innerHTML = '';
                
                const citiesToShow = data.geographic.cities_mentioned.slice(0, 5);
                citiesToShow.forEach(city => {
                    const tag = document.createElement('span');
                    tag.className = 'city-tag';
                    tag.textContent = city;
                    cityTagsContainer.appendChild(tag);
                });
                
                console.log('‚úì Iran protests data loaded successfully');
                
            } catch (error) {
                console.error('Error loading protest data:', error);
                document.getElementById('cities-affected').textContent = '--';
                document.getElementById('provinces-affected').textContent = translations[currentLang]['provinces-label'];
            }
        }

        // Load articles from all sources
        async function loadArticles() {
            try {
                const response = await fetch(`${API_BASE_URL}/scan-iran-protests?days=7`);
                if (!response.ok) throw new Error('Failed to fetch articles');
                
                const data = await response.json();
                console.log('Articles data:', data);
                
                // Store all articles by source
                allArticlesData = {
                    hrana: data.articles_hrana || [],
                    iranwire: data.articles_iranwire || [],
                    farsi: data.articles_fa || [],
                    english: data.articles_en || [],
                    hebrew: data.articles_he || [],
                    arabic: data.articles_ar || [],
                    reddit: data.articles_reddit || []
                };

                // Update tab counts
                document.getElementById('hrana-count').textContent = allArticlesData.hrana.length;
                document.getElementById('iranwire-count').textContent = allArticlesData.iranwire.length;
                document.getElementById('farsi-count').textContent = allArticlesData.farsi.length;
                document.getElementById('english-count').textContent = allArticlesData.english.length;
                document.getElementById('hebrew-count').textContent = allArticlesData.hebrew.length;
                document.getElementById('arabic-count').textContent = allArticlesData.arabic.length;
                document.getElementById('reddit-count').textContent = allArticlesData.reddit.length;

                // Display initial articles (HRANA by default)
                displayArticles(currentSource);
                
            } catch (error) {
                console.error('Error loading articles:', error);
                document.getElementById('articles-container').innerHTML = 
                    `<div class="error">Failed to load articles: ${error.message}</div>`;
            }
        }

        // Display articles for selected source
        function displayArticles(source) {
            const container = document.getElementById('articles-container');
            const articles = allArticlesData[source] || [];

            if (articles.length === 0) {
                container.innerHTML = '<div class="no-articles">No articles available from this source.</div>';
                return;
            }

            container.innerHTML = articles.map(article => `
                <div class="article-card">
                    <div class="article-title">${article.title || 'Untitled'}</div>
                    <div class="article-source">${article.source?.name || 'Unknown Source'}</div>
                    <div class="article-description">${article.description || article.content?.substring(0, 200) || 'No description available'}...</div>
                    <a href="${article.url || article.link || '#'}" target="_blank" class="article-link">
                        Read more ‚Üí
                    </a>
                </div>
            `).join('');
        }

        // Tab switching functionality
        document.querySelectorAll('.news-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.news-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                currentSource = tab.dataset.source;
                displayArticles(currentSource);
            });
        });

        // Load all data on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadProtestData();
            loadArticles();
        });

        // Refresh data every 5 minutes
        setInterval(() => {
            loadProtestData();
            loadArticles();
        }, 300000);
    </script>
</body>
</html>
