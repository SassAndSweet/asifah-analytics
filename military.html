<!DOCTYPE html>
<!-- Asifah Analytics - Military Asset & Deployment Tracker v1.1.0 - Feb 18, 2026 -->
<!-- COPYRIGHT (c) 2025-2026 Asifah Analytics. All rights reserved. -->
<html lang="en" dir="ltr">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Z9114D1Z5C"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-Z9114D1Z5C');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Military Posture Tracker | Asifah Analytics</title>
    <link rel="icon" type="image/png" href="https://raw.githubusercontent.com/SassAndSweet/asifah-analytics/main/Asifah_Analytics_1_25_26_V1_LOGO.png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@400;600;700&family=Noto+Sans+Hebrew:wght@400;600;700&display=swap');
        * { margin: 0; padding: 0; box-sizing: border-box; }

        /* ====== LIGHT MODE ====== */
        :root {
            --bg-primary: #f0f4f7;
            --bg-card: #ffffff;
            --bg-signal: #f0f5fa;
            --border-color: #d1dce6;
            --text-primary: #2c3e50;
            --text-secondary: #4a6178;
            --text-muted: #8899aa;
            --header-gradient-start: #1e3a5f;
            --header-gradient-end: #2c5282;
            --accent-blue: #3182ce;
            --accent-cyan: #0bc5ea;
            --accent-green: #38a169;
            --accent-yellow: #d69e2e;
            --accent-orange: #dd6b20;
            --accent-red: #e53e3e;
            --alert-green-bg: #f0fff4; --alert-green-border: #38a169;
            --alert-yellow-bg: #fffff0; --alert-yellow-border: #d69e2e;
            --alert-orange-bg: #fffaf0; --alert-orange-border: #dd6b20;
            --alert-red-bg: #fff5f5; --alert-red-border: #e53e3e;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --grid-color: transparent;
            --scanline-opacity: 0;
            --glow-opacity: 0;
            --watermark-opacity: 0.5;
            --watermark-size: 500px;
            --cyber-border: var(--border-color);
            --loading-bg: rgba(240,244,247,0.95);
        }

        /* ====== DARK MODE ====== */
        [data-theme="dark"] {
            --bg-primary: #0a0e17;
            --bg-card: #1a2332;
            --bg-signal: #151d2b;
            --border-color: #2a3a4e;
            --text-primary: #e2e8f0;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --header-gradient-start: #0d1b2a;
            --header-gradient-end: #1b2838;
            --accent-blue: #00d4ff;
            --accent-cyan: #00ffd5;
            --accent-green: #00ff88;
            --accent-yellow: #ffcc00;
            --accent-orange: #ff8c00;
            --accent-red: #ff3b3b;
            --alert-green-bg: rgba(0,255,136,0.08); --alert-green-border: #00ff88;
            --alert-yellow-bg: rgba(255,204,0,0.08); --alert-yellow-border: #ffcc00;
            --alert-orange-bg: rgba(255,140,0,0.08); --alert-orange-border: #ff8c00;
            --alert-red-bg: rgba(255,59,59,0.08); --alert-red-border: #ff3b3b;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
            --grid-color: rgba(0,212,255,0.04);
            --scanline-opacity: 0.03;
            --glow-opacity: 1;
            --watermark-opacity: 1;
            --watermark-size: 800px;
            --cyber-border: rgba(0,212,255,0.15);
            --loading-bg: rgba(10,14,23,0.95);
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: background-color 0.4s ease, color 0.4s ease;
            overflow-x: hidden;
        }

        /* Cyber grid (dark only) */
        body::before {
            content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background-image: linear-gradient(var(--grid-color) 1px, transparent 1px), linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 40px 40px; pointer-events: none; z-index: 0;
        }
        /* Scanlines (dark only) */
        body::after {
            content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,212,255,var(--scanline-opacity)) 2px, rgba(0,212,255,var(--scanline-opacity)) 4px);
            pointer-events: none; z-index: 0;
        }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 20px 40px; position: relative; z-index: 1; }

        /* Watermark logo */
        .watermark {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: var(--watermark-size); height: var(--watermark-size);
            opacity: var(--watermark-opacity); pointer-events: none; z-index: 0;
            background-image: url('https://raw.githubusercontent.com/SassAndSweet/asifah-analytics/main/Asifah_Analytics_1_25_26_V1_LOGO.png');
            background-size: 135%; background-repeat: no-repeat; background-position: center;
            border-radius: 50%;
            transition: all 0.4s ease;
        }

        /* ====== HEADER ====== */
        .header {
            background: linear-gradient(135deg, var(--header-gradient-start), var(--header-gradient-end));
            padding: 16px 30px; margin-bottom: 24px; border-radius: 0 0 12px 12px;
            position: relative; overflow: hidden;
        }
        [data-theme="dark"] .header { border-bottom: 1px solid var(--cyber-border); box-shadow: 0 0 30px rgba(0,212,255,0.05); }
        .header::after {
            content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-cyan), transparent);
            opacity: var(--glow-opacity);
        }

        .header-row-1 { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .header-logo { width: 52px; height: 52px; border-radius: 50%; border: 2px solid rgba(255,255,255,0.3); }
        [data-theme="dark"] .header-logo { border-color: var(--accent-cyan); box-shadow: 0 0 12px rgba(0,212,255,0.3); }
        .header-right-controls { display: flex; gap: 8px; align-items: center; }

        .home-btn {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3);
            color: #fff; padding: 6px 16px; border-radius: 6px; cursor: pointer;
            font-family: 'Times New Roman', Times, serif; font-size: 0.85rem; font-weight: 600;
            text-decoration: none; display: inline-flex; align-items: center; gap: 6px; transition: all 0.3s;
        }
        .home-btn:hover { background: rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.5); }

        .lang-btn {
            background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2);
            color: #fff; padding: 5px 12px; border-radius: 5px; cursor: pointer;
            font-family: 'Times New Roman', Times, serif; font-size: 0.8rem; transition: all 0.3s;
        }
        .lang-btn:hover { background: rgba(255,255,255,0.2); }
        .lang-btn.active { background: rgba(255,255,255,0.25); border-color: rgba(255,255,255,0.5); }

        .header-row-2 { text-align: center; padding-bottom: 4px; }
        .header-title {
            font-family: 'Times New Roman', Times, serif; font-size: 1.8rem; font-weight: 700;
            color: #ffffff; letter-spacing: 4px; text-transform: uppercase;
        }
        [data-theme="dark"] .header-title { text-shadow: 0 0 20px rgba(0,212,255,0.4); }
        .header-subtitle { font-size: 0.85rem; color: rgba(255,255,255,0.6); letter-spacing: 2px; margin-top: 4px; }

        .header-row-3 { display: flex; justify-content: flex-end; align-items: center; margin-top: 6px; }

        .toggle-container { display: flex; align-items: center; gap: 8px; color: rgba(255,255,255,0.7); font-size: 0.8rem; letter-spacing: 1px; }
        .toggle-label { text-transform: uppercase; }
        .toggle-switch {
            position: relative; width: 44px; height: 22px; background: rgba(255,255,255,0.2);
            border-radius: 11px; cursor: pointer; transition: background 0.3s; border: 1px solid rgba(255,255,255,0.3);
        }
        .toggle-switch::after {
            content: ''; position: absolute; top: 2px; left: 2px; width: 16px; height: 16px;
            background: #fff; border-radius: 50%; transition: transform 0.3s;
        }
        .toggle-switch.active { background: rgba(0,212,255,0.4); border-color: rgba(0,212,255,0.6); }
        .toggle-switch.active::after { transform: translateX(22px); }

        .refresh-btn {
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: #fff; width: 34px; height: 34px; border-radius: 6px; cursor: pointer;
            font-size: 1.1rem; display: flex; align-items: center; justify-content: center;
            transition: all 0.3s; margin-left: 12px;
        }
        .refresh-btn:hover { background: rgba(255,255,255,0.2); }

        /* ====== STATUS STRIP ====== */
        .status-strip { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 24px; }
        .status-card {
            background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px;
            padding: 16px 20px; text-align: center; box-shadow: var(--shadow-sm); transition: all 0.3s;
        }
        [data-theme="dark"] .status-card { border-color: var(--cyber-border); }
        .status-card.alert-elevated { border-left: 4px solid var(--accent-yellow); background: var(--alert-yellow-bg); }
        .status-card.alert-high { border-left: 4px solid var(--accent-orange); background: var(--alert-orange-bg); }
        .status-card.alert-surge { border-left: 4px solid var(--accent-red); background: var(--alert-red-bg); }
        [data-theme="dark"] .status-card.alert-surge { animation: pulse-red 3s ease-in-out infinite; }
        @keyframes pulse-red { 0%,100%{box-shadow:0 0 20px rgba(255,59,59,0.1)} 50%{box-shadow:0 0 30px rgba(255,59,59,0.2)} }
        .status-card .label { font-size: 0.75rem; color: var(--text-muted); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 6px; }
        .status-card .value { font-size: 2rem; font-weight: 700; color: var(--text-primary); line-height: 1; }
        .status-card .sub { font-size: 0.75rem; color: var(--text-secondary); margin-top: 4px; }

        /* ====== SECTION HEADERS ====== */
        .section-header {
            font-size: 1.2rem; font-weight: 700; color: var(--text-primary); letter-spacing: 2px;
            text-transform: uppercase; margin: 28px 0 16px; padding-bottom: 8px;
            border-bottom: 2px solid var(--border-color); display: flex; align-items: center; gap: 10px;
        }
        [data-theme="dark"] .section-header { border-bottom-color: var(--cyber-border); }

        /* ====== ACTOR CARDS ====== */
        .actor-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; }
        .actor-card {
            background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px;
            padding: 20px; box-shadow: var(--shadow-sm); transition: all 0.3s;
        }
        .actor-card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); }
        [data-theme="dark"] .actor-card { border-color: var(--cyber-border); }
        [data-theme="dark"] .actor-card:hover { box-shadow: 0 0 20px rgba(0,212,255,0.08); border-color: rgba(0,212,255,0.3); }
        .actor-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .actor-flag { font-size: 1.2rem; }
        .actor-name { font-size: 1.1rem; font-weight: 700; letter-spacing: 1px; }
        .actor-tier { font-size: 0.65rem; color: var(--text-muted); letter-spacing: 2px; text-transform: uppercase; }

        .alert-badge { display: inline-block; padding: 3px 10px; border-radius: 4px; font-size: 0.7rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; }
        .alert-badge.normal { background: var(--alert-green-bg); color: var(--accent-green); border: 1px solid var(--alert-green-border); }
        .alert-badge.elevated { background: var(--alert-yellow-bg); color: var(--accent-yellow); border: 1px solid var(--alert-yellow-border); }
        .alert-badge.high { background: var(--alert-orange-bg); color: var(--accent-orange); border: 1px solid var(--alert-orange-border); }
        .alert-badge.surge { background: var(--alert-red-bg); color: var(--accent-red); border: 1px solid var(--alert-red-border); }
        [data-theme="dark"] .alert-badge.surge { box-shadow: 0 0 8px rgba(255,59,59,0.3); }

        .actor-stats { display: flex; gap: 16px; margin: 12px 0; }
        .actor-stat .stat-value { font-size: 1.4rem; font-weight: 700; color: var(--accent-blue); }
        .actor-stat .stat-label { font-size: 0.6rem; color: var(--text-muted); letter-spacing: 1px; text-transform: uppercase; }
        .actor-top-signal { background: var(--bg-signal); border-radius: 6px; padding: 10px 12px; margin-top: 10px; border-left: 3px solid var(--accent-blue); }
        .actor-top-signal .signal-title { font-size: 0.8rem; color: var(--text-primary); line-height: 1.4; }
        .actor-top-signal .signal-meta { font-size: 0.65rem; color: var(--text-muted); margin-top: 4px; }

        /* ====== TARGET CARDS ====== */
        .target-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
        .target-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 10px; padding: 20px; box-shadow: var(--shadow-sm); }
        [data-theme="dark"] .target-card { border-color: var(--cyber-border); }
        .target-card.elevated { border-top: 3px solid var(--accent-yellow); }
        .target-card.high { border-top: 3px solid var(--accent-orange); }
        .target-card.surge { border-top: 3px solid var(--accent-red); }
        .target-name { font-size: 1rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; }
        .target-score { font-size: 2rem; font-weight: 700; line-height: 1; }
        .target-score-label { font-size: 0.6rem; color: var(--text-muted); letter-spacing: 2px; text-transform: uppercase; }

        /* ====== ASSETS ====== */
        .asset-bar-container { display: flex; gap: 12px; flex-wrap: wrap; }
        .asset-chip { display: flex; align-items: center; gap: 8px; background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; padding: 10px 16px; box-shadow: var(--shadow-sm); }
        [data-theme="dark"] .asset-chip { border-color: var(--cyber-border); }
        .chip-icon { font-size: 1.4rem; }
        .chip-label { font-size: 0.8rem; font-weight: 600; color: var(--text-secondary); }
        .chip-count { font-size: 1.2rem; font-weight: 700; color: var(--accent-blue); }

        /* ====== SIGNAL FEED ====== */
        .signal-feed { display: flex; flex-direction: column; gap: 8px; }
        .signal-item {
            background: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px;
            padding: 14px 18px; display: flex; align-items: flex-start; gap: 14px; box-shadow: var(--shadow-sm); transition: all 0.3s;
        }
        .signal-item:hover { box-shadow: var(--shadow-md); border-color: var(--accent-blue); }
        [data-theme="dark"] .signal-item { border-color: var(--cyber-border); }
        [data-theme="dark"] .signal-item:hover { border-color: var(--accent-cyan); }
        .signal-icons { display: flex; flex-direction: column; align-items: center; gap: 2px; min-width: 40px; }
        .signal-flag { font-size: 1.4rem; }
        .signal-asset-icon { font-size: 1rem; }
        .signal-body { flex: 1; }
        .signal-headline { font-size: 0.85rem; font-weight: 600; color: var(--text-primary); line-height: 1.4; margin-bottom: 4px; }
        .signal-headline a { color: var(--text-primary); text-decoration: none; }
        .signal-headline a:hover { color: var(--accent-blue); text-decoration: underline; }
        .signal-details { font-size: 0.65rem; color: var(--text-muted); display: flex; gap: 12px; flex-wrap: wrap; }
        .signal-weight { min-width: 50px; padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; font-weight: 700; color: #fff; background: var(--accent-blue); text-align: center; }
        .signal-weight.high { background: var(--accent-orange); }
        .signal-weight.critical { background: var(--accent-red); }

        /* ====== FOOTER ====== */
        .source-footer { display: flex; justify-content: center; gap: 24px; flex-wrap: wrap; margin-top: 32px; padding: 20px; border-top: 1px solid var(--border-color); }
        .source-count { font-size: 1.4rem; font-weight: 700; color: var(--accent-blue); text-align: center; }
        .source-label { font-size: 0.6rem; color: var(--text-muted); letter-spacing: 1px; text-transform: uppercase; text-align: center; }
        .page-footer { text-align: center; padding: 24px 20px; margin-top: 20px; border-top: 1px solid var(--border-color); }
        .page-footer .copyright { font-size: 0.7rem; color: var(--text-muted); letter-spacing: 1px; }
        .page-footer .back-link { display: inline-block; margin-top: 10px; font-size: 0.85rem; font-weight: 600; color: var(--accent-blue); text-decoration: none; }
        .page-footer .back-link:hover { text-decoration: underline; }

        /* ====== LOADING ====== */
        .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--loading-bg); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; transition: opacity 0.5s; }
        .loading-overlay.hidden { opacity: 0; pointer-events: none; }
        .loading-spinner { width: 48px; height: 48px; border: 3px solid var(--border-color); border-top-color: var(--accent-blue); border-radius: 50%; animation: spin 1s linear infinite; }
        [data-theme="dark"] .loading-spinner { border-color: var(--cyber-border); border-top-color: var(--accent-cyan); }
        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { font-size: 0.85rem; color: var(--text-secondary); margin-top: 16px; letter-spacing: 2px; }
        .error-banner { background: var(--alert-red-bg); border: 1px solid var(--alert-red-border); border-radius: 8px; padding: 16px 20px; text-align: center; color: var(--accent-red); display: none; }
        .updated-bar { font-size: 0.65rem; color: var(--text-muted); text-align: center; padding: 8px; letter-spacing: 1px; }

        /* ====== RTL ====== */
        [dir="rtl"] .actor-top-signal { border-left: none; border-right: 3px solid var(--accent-blue); }
        [dir="rtl"] .status-card.alert-elevated { border-left: none; border-right: 4px solid var(--accent-yellow); }
        [dir="rtl"] .status-card.alert-high { border-left: none; border-right: 4px solid var(--accent-orange); }
        [dir="rtl"] .status-card.alert-surge { border-left: none; border-right: 4px solid var(--accent-red); }
        [dir="rtl"] .header-row-3 { justify-content: flex-start; }

        @media (max-width: 768px) {
            .header-row-1 { flex-direction: column; gap: 10px; align-items: flex-start; }
            .header-right-controls { flex-wrap: wrap; }
            .header-title { font-size: 1.3rem; letter-spacing: 2px; }
            .status-strip { grid-template-columns: repeat(2, 1fr); }
            .actor-grid, .target-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
<div class="watermark"></div>
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text" data-i18n="loading">SCANNING MILITARY POSTURE...</div>
</div>

<header class="header">
    <div class="header-row-1">
        <img src="https://raw.githubusercontent.com/SassAndSweet/asifah-analytics/main/Asifah_Analytics_1_25_26_V1_LOGO.png" alt="Asifah Analytics" class="header-logo">
        <div class="header-right-controls">
            <a href="index.html" class="home-btn">&#127968; HOME</a>
            <button class="lang-btn active" onclick="setLanguage('en')">EN</button>
            <button class="lang-btn" onclick="setLanguage('ar')">&#1593;&#1585;&#1576;&#1610;</button>
            <button class="lang-btn" onclick="setLanguage('he')">&#1506;&#1489;&#1512;&#1497;&#1514;</button>
            <button class="lang-btn" onclick="setLanguage('fa')">&#1601;&#1575;&#1585;&#1587;&#1740;</button>
        </div>
    </div>
    <div class="header-row-2">
        <div class="header-title" data-i18n="pageTitle">MILITARY POSTURE TRACKER</div>
        <div class="header-subtitle" data-i18n="pageSubtitle">Multi-Actor Deployment Intelligence</div>
    </div>
    <div class="header-row-3">
        <div class="toggle-container">
            <span class="toggle-label" data-i18n="toggleLabel">TOGGLE: LIGHT - DARK</span>
            <div class="toggle-switch" id="themeToggle" onclick="toggleTheme()"></div>
        </div>
        <button class="refresh-btn" onclick="refreshData()" title="Refresh">&#x27F3;</button>
    </div>
</header>

<div class="container">
    <div class="error-banner" id="errorBanner"></div>
    <div class="status-strip">
        <div class="status-card" id="statusArticles"><div class="label" data-i18n="articlesScanned">ARTICLES SCANNED</div><div class="value" id="totalArticles">&mdash;</div><div class="sub" data-i18n="last7Days">Last 7 days</div></div>
        <div class="status-card" id="statusSignals"><div class="label" data-i18n="signalsDetected">SIGNALS DETECTED</div><div class="value" id="totalSignals">&mdash;</div></div>
        <div class="status-card" id="statusActors"><div class="label" data-i18n="activeActors">ACTIVE ACTORS</div><div class="value" id="activeActors">&mdash;</div></div>
        <div class="status-card" id="statusTension"><div class="label" data-i18n="tensionMultiplier">TENSION MULTIPLIER</div><div class="value" id="tensionMultiplier">&mdash;</div><div class="sub" id="tensionSub"></div></div>
    </div>

    <div class="section-header"><span class="icon">&#127894;</span> <span data-i18n="sectionActors">Active Military Actors</span></div>
    <div class="actor-grid" id="actorGrid"></div>

    <div class="section-header"><span class="icon">&#127919;</span> <span data-i18n="sectionTargets">Target Posture Assessment</span></div>
    <div class="target-grid" id="targetGrid"></div>

    <div class="section-header"><span class="icon">&#9881;</span> <span data-i18n="sectionAssets">Asset Distribution</span></div>
    <div class="asset-bar-container" id="assetBar"></div>

    <div class="section-header"><span class="icon">&#128225;</span> <span data-i18n="sectionSignals">Signal Feed (Weighted by Impact)</span></div>
    <div class="signal-feed" id="signalFeed"></div>

    <div class="source-footer" id="sourceFooter"></div>
    <div class="updated-bar" id="updatedBar"></div>
    <div class="page-footer">
        <div class="copyright">&copy; 2025-2026 ASIFAH ANALYTICS &mdash; ALL RIGHTS RESERVED &mdash; v1.1.0</div>
        <a href="index.html" class="back-link" data-i18n="backToMain">&larr; Back to Main Dashboard</a>
    </div>
</div>

<script>
var API_BASE = 'https://asifah-backend.onrender.com';
var ENDPOINT = API_BASE + '/api/military-posture';

var TRANSLATIONS = {
    en: { pageTitle:'MILITARY POSTURE TRACKER', pageSubtitle:'Multi-Actor Deployment Intelligence', loading:'SCANNING MILITARY POSTURE...', articlesScanned:'ARTICLES SCANNED', signalsDetected:'SIGNALS DETECTED', activeActors:'ACTIVE ACTORS', tensionMultiplier:'TENSION MULTIPLIER', last7Days:'Last 7 days', sectionActors:'Active Military Actors', sectionTargets:'Target Posture Assessment', sectionAssets:'Asset Distribution', sectionSignals:'Signal Feed (Weighted by Impact)', backToMain:'\u2190 Back to Main Dashboard', toggleLabel:'TOGGLE: LIGHT - DARK', signals:'signals', score:'Score', topSignal:'Top Signal', defenseRSS:'DEFENSE RSS', gdelt:'GDELT', newsapi:'NEWSAPI', reddit:'REDDIT', lastUpdated:'Last Updated', scanTime:'Scan Time' },
    ar: { pageTitle:'\u0645\u062a\u062a\u0628\u0639 \u0627\u0644\u0648\u0636\u0639 \u0627\u0644\u0639\u0633\u0643\u0631\u064a', pageSubtitle:'\u0627\u0633\u062a\u062e\u0628\u0627\u0631\u0627\u062a \u0627\u0644\u0646\u0634\u0631 \u0645\u062a\u0639\u062f\u062f \u0627\u0644\u0623\u0637\u0631\u0627\u0641', loading:'\u062c\u0627\u0631\u064d \u0645\u0633\u062d \u0627\u0644\u0648\u0636\u0639 \u0627\u0644\u0639\u0633\u0643\u0631\u064a...', articlesScanned:'\u0627\u0644\u0645\u0642\u0627\u0644\u0627\u062a \u0627\u0644\u0645\u0645\u0633\u0648\u062d\u0629', signalsDetected:'\u0627\u0644\u0625\u0634\u0627\u0631\u0627\u062a \u0627\u0644\u0645\u0643\u062a\u0634\u0641\u0629', activeActors:'\u0627\u0644\u0623\u0637\u0631\u0627\u0641 \u0627\u0644\u0646\u0634\u0637\u0629', tensionMultiplier:'\u0645\u0636\u0627\u0639\u0641 \u0627\u0644\u062a\u0648\u062a\u0631', last7Days:'\u0622\u062e\u0631 7 \u0623\u064a\u0627\u0645', sectionActors:'\u0627\u0644\u0623\u0637\u0631\u0627\u0641 \u0627\u0644\u0639\u0633\u0643\u0631\u064a\u0629 \u0627\u0644\u0646\u0634\u0637\u0629', sectionTargets:'\u062a\u0642\u064a\u064a\u0645 \u0648\u0636\u0639 \u0627\u0644\u0623\u0647\u062f\u0627\u0641', sectionAssets:'\u062a\u0648\u0632\u064a\u0639 \u0627\u0644\u0623\u0635\u0648\u0644', sectionSignals:'\u062a\u063a\u0630\u064a\u0629 \u0627\u0644\u0625\u0634\u0627\u0631\u0627\u062a', backToMain:'\u2192 \u0627\u0644\u0639\u0648\u062f\u0629 \u0644\u0644\u0648\u062d\u0629 \u0627\u0644\u0631\u0626\u064a\u0633\u064a\u0629', toggleLabel:'\u062a\u0628\u062f\u064a\u0644: \u0641\u0627\u062a\u062d - \u062f\u0627\u0643\u0646', signals:'\u0625\u0634\u0627\u0631\u0627\u062a', score:'\u0627\u0644\u0646\u062a\u064a\u062c\u0629', topSignal:'\u0623\u0639\u0644\u0649 \u0625\u0634\u0627\u0631\u0629', defenseRSS:'RSS \u0627\u0644\u062f\u0641\u0627\u0639\u064a\u0629', gdelt:'GDELT', newsapi:'NEWSAPI', reddit:'\u0631\u064a\u062f\u064a\u062a', lastUpdated:'\u0622\u062e\u0631 \u062a\u062d\u062f\u064a\u062b', scanTime:'\u0648\u0642\u062a \u0627\u0644\u0645\u0633\u062d' },
    he: { pageTitle:'\u05de\u05e2\u05e7\u05d1 \u05de\u05e6\u05d1 \u05e6\u05d1\u05d0\u05d9', pageSubtitle:'\u05de\u05d5\u05d3\u05d9\u05e2\u05d9\u05df \u05e4\u05e8\u05d9\u05e1\u05d4 \u05e8\u05d1-\u05e9\u05d7\u05e7\u05e0\u05d9\u05dd', loading:'\u05e1\u05d5\u05e8\u05e7 \u05de\u05e6\u05d1 \u05e6\u05d1\u05d0\u05d9...', articlesScanned:'\u05db\u05ea\u05d1\u05d5\u05ea \u05e0\u05e1\u05e8\u05e7\u05d5', signalsDetected:'\u05d0\u05d5\u05ea\u05d5\u05ea \u05d6\u05d5\u05d4\u05d5', activeActors:'\u05e9\u05d7\u05e7\u05e0\u05d9\u05dd \u05e4\u05e2\u05d9\u05dc\u05d9\u05dd', tensionMultiplier:'\u05de\u05db\u05e4\u05d9\u05dc \u05de\u05ea\u05d7', last7Days:'7 \u05d9\u05de\u05d9\u05dd \u05d0\u05d7\u05e8\u05d5\u05e0\u05d9\u05dd', sectionActors:'\u05e9\u05d7\u05e7\u05e0\u05d9\u05dd \u05e6\u05d1\u05d0\u05d9\u05d9\u05dd \u05e4\u05e2\u05d9\u05dc\u05d9\u05dd', sectionTargets:'\u05d4\u05e2\u05e8\u05db\u05ea \u05de\u05e6\u05d1 \u05de\u05d8\u05e8\u05d5\u05ea', sectionAssets:'\u05e4\u05d9\u05d6\u05d5\u05e8 \u05e0\u05db\u05e1\u05d9\u05dd', sectionSignals:'\u05e4\u05d9\u05d3 \u05d0\u05d5\u05ea\u05d5\u05ea', backToMain:'\u2190 \u05d7\u05d6\u05e8\u05d4 \u05dc\u05dc\u05d5\u05d7 \u05d4\u05e8\u05d0\u05e9\u05d9', toggleLabel:'\u05de\u05e6\u05d1: \u05d1\u05d4\u05d9\u05e8 - \u05db\u05d4\u05d4', signals:'\u05d0\u05d5\u05ea\u05d5\u05ea', score:'\u05e6\u05d9\u05d5\u05df', topSignal:'\u05d0\u05d5\u05ea \u05de\u05d5\u05d1\u05d9\u05dc', defenseRSS:'RSS \u05d1\u05d9\u05d8\u05d7\u05d5\u05e0\u05d9', gdelt:'GDELT', newsapi:'NEWSAPI', reddit:'\u05e8\u05d3\u05d9\u05d8', lastUpdated:'\u05e2\u05d3\u05db\u05d5\u05df \u05d0\u05d7\u05e8\u05d5\u05df', scanTime:'\u05d6\u05de\u05df \u05e1\u05e8\u05d9\u05e7\u05d4' },
    fa: { pageTitle:'\u0631\u062f\u06cc\u0627\u0628 \u0648\u0636\u0639\u06cc\u062a \u0646\u0638\u0627\u0645\u06cc', pageSubtitle:'\u0627\u0637\u0644\u0627\u0639\u0627\u062a \u0627\u0633\u062a\u0642\u0631\u0627\u0631 \u0686\u0646\u062f \u0628\u0627\u0632\u06cc\u06af\u0631', loading:'\u062f\u0631 \u062d\u0627\u0644 \u0627\u0633\u06a9\u0646...', articlesScanned:'\u0645\u0642\u0627\u0644\u0627\u062a \u0627\u0633\u06a9\u0646 \u0634\u062f\u0647', signalsDetected:'\u0633\u06cc\u06af\u0646\u0627\u0644 \u0634\u0646\u0627\u0633\u0627\u06cc\u06cc', activeActors:'\u0628\u0627\u0632\u06cc\u06af\u0631\u0627\u0646 \u0641\u0639\u0627\u0644', tensionMultiplier:'\u0636\u0631\u06cc\u0628 \u062a\u0646\u0634', last7Days:'7 \u0631\u0648\u0632 \u06af\u0630\u0634\u062a\u0647', sectionActors:'\u0628\u0627\u0632\u06cc\u06af\u0631\u0627\u0646 \u0646\u0638\u0627\u0645\u06cc \u0641\u0639\u0627\u0644', sectionTargets:'\u0627\u0631\u0632\u06cc\u0627\u0628\u06cc \u0648\u0636\u0639\u06cc\u062a \u0627\u0647\u062f\u0627\u0641', sectionAssets:'\u062a\u0648\u0632\u06cc\u0639 \u062f\u0627\u0631\u0627\u06cc\u06cc', sectionSignals:'\u0641\u06cc\u062f \u0633\u06cc\u06af\u0646\u0627\u0644', backToMain:'\u2190 \u0628\u0627\u0632\u06af\u0634\u062a', toggleLabel:'\u062a\u063a\u06cc\u06cc\u0631: \u0631\u0648\u0634\u0646 - \u062a\u0627\u0631\u06cc\u06a9', signals:'\u0633\u06cc\u06af\u0646\u0627\u0644', score:'\u0627\u0645\u062a\u06cc\u0627\u0632', topSignal:'\u0633\u06cc\u06af\u0646\u0627\u0644 \u0628\u0631\u062a\u0631', defenseRSS:'RSS \u062f\u0641\u0627\u0639\u06cc', gdelt:'GDELT', newsapi:'NEWSAPI', reddit:'\u0631\u062f\u06cc\u062a', lastUpdated:'\u0622\u062e\u0631\u06cc\u0646 \u0628\u0631\u0648\u0632\u0631\u0633\u0627\u0646\u06cc', scanTime:'\u0632\u0645\u0627\u0646 \u0627\u0633\u06a9\u0646' }
};

var currentLang = 'en';
var TIER_LABELS = { 1:'TIER 1 \u2014 STRIKE', 2:'TIER 2 \u2014 ADVERSARY', 3:'TIER 3 \u2014 REGIONAL', 4:'TIER 4 \u2014 ALLIANCE' };
var ASSET_ICONS = { carrier_strike_group:'\uD83D\uDEA2', submarine:'\uD83D\uDD31', bomber_deployment:'\u2708\uFE0F', amphibious_group:'\u2693', fighter_surge:'\uD83D\uDEE9\uFE0F', air_defense:'\uD83D\uDEE1\uFE0F', isr_assets:'\uD83D\uDC41\uFE0F', ground_forces:'\uD83E\uDE96', logistics:'\uD83D\uDCE6', missile_test:'\uD83D\uDE80', naval_exercise:'\u2693', unspecified:'\u26A0\uFE0F' };
var ASSET_LABELS = { carrier_strike_group:'Carrier Strike Groups', submarine:'Submarines', bomber_deployment:'Strategic Bombers', amphibious_group:'Amphibious Groups', fighter_surge:'Fighter Surges', air_defense:'Air Defense', isr_assets:'ISR Assets', ground_forces:'Ground Forces', logistics:'Logistics', missile_test:'Missile Tests', naval_exercise:'Naval Exercises', unspecified:'General Activity' };

function setLanguage(lang) {
    currentLang = lang;
    var rtl = ['ar','he','fa'];
    document.documentElement.dir = rtl.indexOf(lang) >= 0 ? 'rtl' : 'ltr';
    document.documentElement.lang = lang;
    if (rtl.indexOf(lang) >= 0) {
        document.body.style.fontFamily = "'Noto Sans Arabic', 'Noto Sans Hebrew', 'Times New Roman', serif";
    } else {
        document.body.style.fontFamily = '';
    }
    var els = document.querySelectorAll('[data-i18n]');
    for (var i = 0; i < els.length; i++) {
        var key = els[i].getAttribute('data-i18n');
        if (TRANSLATIONS[lang] && TRANSLATIONS[lang][key]) {
            els[i].textContent = TRANSLATIONS[lang][key];
        }
    }
    var btns = document.querySelectorAll('.lang-btn');
    for (var j = 0; j < btns.length; j++) btns[j].classList.remove('active');
    if (event && event.target) event.target.classList.add('active');
    if (window._lastData) renderAll(window._lastData);
}

function toggleTheme() {
    var current = document.documentElement.getAttribute('data-theme');
    var next = current === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', next);
    var toggle = document.getElementById('themeToggle');
    if (next === 'dark') { toggle.classList.add('active'); } else { toggle.classList.remove('active'); }
    localStorage.setItem('mil-theme', next);
}

function loadTheme() {
    var saved = localStorage.getItem('mil-theme') || 'dark';
    document.documentElement.setAttribute('data-theme', saved);
    var toggle = document.getElementById('themeToggle');
    if (saved === 'dark') { toggle.classList.add('active'); } else { toggle.classList.remove('active'); }
}

async function fetchData(forceRefresh) {
    var loader = document.getElementById('loadingOverlay');
    var errorBanner = document.getElementById('errorBanner');
    loader.classList.remove('hidden');
    errorBanner.style.display = 'none';
    try {
        var url = forceRefresh ? ENDPOINT + '?refresh=true' : ENDPOINT;
        var resp = await fetch(url);
        if (!resp.ok) throw new Error('HTTP ' + resp.status);
        var data = await resp.json();
        if (!data.success) throw new Error(data.error || 'Unknown error');
        window._lastData = data;
        renderAll(data);
    } catch (err) {
        console.error('[Military Tracker] Fetch error:', err);
        errorBanner.innerHTML = '\u26A0\uFE0F Failed to fetch. Try refreshing.';
        errorBanner.style.display = 'block';
    } finally {
        loader.classList.add('hidden');
    }
}

function refreshData() { fetchData(true); }

function renderAll(data) {
    var t = TRANSLATIONS[currentLang] || TRANSLATIONS.en;
    document.getElementById('totalArticles').textContent = (data.total_articles_scanned || 0).toLocaleString();
    document.getElementById('totalSignals').textContent = data.total_signals_detected || 0;
    document.getElementById('activeActors').textContent = data.active_actor_count || 0;
    document.getElementById('tensionMultiplier').textContent = (data.tension_multiplier || 1.0) + 'x';

    var tc = document.getElementById('statusTension');
    tc.className = 'status-card';
    if (data.tension_multiplier >= 1.5) tc.classList.add('alert-surge');
    else if (data.tension_multiplier >= 1.3) tc.classList.add('alert-high');
    else if (data.tension_multiplier >= 1.15) tc.classList.add('alert-elevated');

    var ts = document.getElementById('tensionSub');
    if (data.active_actor_count >= 4) ts.textContent = '4+ actors = MAX multiplier';
    else if (data.active_actor_count === 3) ts.textContent = '3 actors active';
    else if (data.active_actor_count === 2) ts.textContent = '2 actors active';
    else ts.textContent = '';

    renderActors(data.actor_summaries || {}, t);
    renderTargets(data.target_postures || {}, t);
    renderAssets(data.asset_distribution || {});
    renderSignals(data.top_signals || [], t);
    renderSources(data.source_breakdown || {}, t);

    var dt = data.last_updated ? new Date(data.last_updated) : new Date();
    document.getElementById('updatedBar').textContent = t.lastUpdated + ': ' + dt.toLocaleString() + ' | ' + t.scanTime + ': ' + (data.scan_time_seconds || '?') + 's | v' + (data.version || '1.1.0');
}

function renderActors(actors, t) {
    var grid = document.getElementById('actorGrid');
    grid.innerHTML = '';
    var sorted = Object.entries(actors).sort(function(a, b) { return b[1].total_score - a[1].total_score; });
    for (var i = 0; i < sorted.length; i++) {
        var id = sorted[i][0], actor = sorted[i][1];
        var topSig = actor.top_signals && actor.top_signals[0];
        var card = document.createElement('div');
        card.className = 'actor-card';
        var sigHtml = '';
        if (topSig) {
            sigHtml = '<div class="actor-top-signal"><div class="signal-title">' + (topSig.asset_icon||'\u26A0\uFE0F') + ' ' + (topSig.article_title||'') + '</div><div class="signal-meta">' + (topSig.source||'') + ' \u00B7 ' + t.topSignal + '</div></div>';
        }
        card.innerHTML = '<div class="actor-header"><div><span class="actor-flag">' + (actor.flag||'\uD83C\uDFF4') + '</span> <span class="actor-name">' + (actor.name||id) + '</span><div class="actor-tier">' + (TIER_LABELS[actor.tier]||'TIER '+actor.tier) + '</div></div><span class="alert-badge ' + (actor.alert_level||'normal') + '">' + (actor.alert_level||'NORMAL').toUpperCase() + '</span></div><div class="actor-stats"><div class="actor-stat"><div class="stat-value">' + (actor.signal_count||0) + '</div><div class="stat-label">' + t.signals + '</div></div><div class="actor-stat"><div class="stat-value">' + (actor.total_score ? actor.total_score.toFixed(1) : '0') + '</div><div class="stat-label">' + t.score + '</div></div></div>' + sigHtml;
        grid.appendChild(card);
    }
}

function renderTargets(targets, t) {
    var grid = document.getElementById('targetGrid');
    grid.innerHTML = '';
    var colorMap = { normal:'var(--accent-green)', elevated:'var(--accent-yellow)', high:'var(--accent-orange)', surge:'var(--accent-red)' };
    var sorted = Object.entries(targets).sort(function(a, b) { return b[1].score - a[1].score; });
    for (var i = 0; i < sorted.length; i++) {
        var name = sorted[i][0], p = sorted[i][1];
        var card = document.createElement('div');
        card.className = 'target-card ' + (p.alert_level||'normal');
        card.innerHTML = '<div class="target-name">' + (p.alert_icon||'\uD83D\uDFE2') + ' ' + name.replace(/_/g,' ') + '</div><div style="display:flex;align-items:baseline;gap:10px"><div class="target-score" style="color:' + (colorMap[p.alert_level]||'var(--text-primary)') + '">' + (p.score ? p.score.toFixed(1) : '0') + '</div><span class="alert-badge ' + (p.alert_level||'normal') + '">' + (p.alert_label||'Normal').toUpperCase() + '</span></div><div class="target-score-label">' + t.score + ' \u00B7 ' + (p.tension_multiplier||1.0) + 'x multiplier</div>';
        grid.appendChild(card);
    }
}

function renderAssets(assets) {
    var bar = document.getElementById('assetBar');
    bar.innerHTML = '';
    var sorted = Object.entries(assets).sort(function(a, b) { return b[1] - a[1]; });
    for (var i = 0; i < sorted.length; i++) {
        var type = sorted[i][0], count = sorted[i][1];
        var chip = document.createElement('div');
        chip.className = 'asset-chip';
        chip.innerHTML = '<span class="chip-icon">' + (ASSET_ICONS[type]||'\u26A0\uFE0F') + '</span><div><div class="chip-count">' + count + '</div><div class="chip-label">' + (ASSET_LABELS[type]||type) + '</div></div>';
        bar.appendChild(chip);
    }
}

function renderSignals(signals, t) {
    var feed = document.getElementById('signalFeed');
    feed.innerHTML = '';
    var seen = {};
    var unique = [];
    for (var i = 0; i < signals.length; i++) {
        if (!seen[signals[i].article_url]) { seen[signals[i].article_url] = true; unique.push(signals[i]); }
    }
    for (var j = 0; j < Math.min(unique.length, 20); j++) {
        var sig = unique[j];
        var item = document.createElement('div');
        item.className = 'signal-item';
        var wc = sig.weight >= 5.0 ? 'critical' : sig.weight >= 3.0 ? 'high' : '';
        var pd = sig.published ? new Date(sig.published).toLocaleDateString() : '';
        item.innerHTML = '<div class="signal-icons"><span class="signal-flag">' + (sig.actor_flag||'\uD83C\uDFF4') + '</span><span class="signal-asset-icon">' + (sig.asset_icon||'\u26A0\uFE0F') + '</span></div><div class="signal-body"><div class="signal-headline"><a href="' + (sig.article_url||'#') + '" target="_blank" rel="noopener">' + (sig.article_title||'Untitled') + '</a></div><div class="signal-details"><span>' + (sig.actor_name||'') + '</span><span>' + (sig.asset_label||'Activity') + '</span><span>' + (sig.source||'') + '</span><span>' + pd + '</span></div></div><div class="signal-weight ' + wc + '">' + (sig.weight ? sig.weight.toFixed(1) : '?') + '</div>';
        feed.appendChild(item);
    }
}

function renderSources(breakdown, t) {
    var footer = document.getElementById('sourceFooter');
    footer.innerHTML = '';
    var sources = [{key:'defense_rss',label:t.defenseRSS},{key:'gdelt',label:t.gdelt},{key:'newsapi',label:t.newsapi},{key:'reddit',label:t.reddit}];
    for (var i = 0; i < sources.length; i++) {
        var item = document.createElement('div');
        item.innerHTML = '<div class="source-count">' + ((breakdown[sources[i].key]||0).toLocaleString()) + '</div><div class="source-label">' + sources[i].label + '</div>';
        footer.appendChild(item);
    }
}

document.addEventListener('DOMContentLoaded', function() {
    loadTheme();
    fetchData(false);
});
</script>
</body>
</html>
